<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 6 Attachements | Term paper Radiative Transfer - Ecosystem and Atmosphere Processes</title>
  <meta name="description" content="Section 6 Attachements | Term paper Radiative Transfer - Ecosystem and Atmosphere Processes" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 6 Attachements | Term paper Radiative Transfer - Ecosystem and Atmosphere Processes" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 6 Attachements | Term paper Radiative Transfer - Ecosystem and Atmosphere Processes" />
  
  
  

<meta name="author" content="Simone Massaro" />


<meta name="date" content="2021-03-31" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="discussion.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Radiative transfer - Term paper</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="theory.html"><a href="theory.html"><i class="fa fa-check"></i><b>2</b> Theory</a>
<ul>
<li class="chapter" data-level="2.0.1" data-path="theory.html"><a href="theory.html#shortwave-radiation"><i class="fa fa-check"></i><b>2.0.1</b> Shortwave radiation</a></li>
<li class="chapter" data-level="2.0.2" data-path="theory.html"><a href="theory.html#longwave-radiation"><i class="fa fa-check"></i><b>2.0.2</b> Longwave radiation</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="model-development.html"><a href="model-development.html"><i class="fa fa-check"></i><b>3</b> Model development</a>
<ul>
<li class="chapter" data-level="3.1" data-path="model-development.html"><a href="model-development.html#parameters"><i class="fa fa-check"></i><b>3.1</b> Parameters</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="model-development.html"><a href="model-development.html#lai"><i class="fa fa-check"></i><b>3.1.1</b> LAI</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="model-development.html"><a href="model-development.html#sensitivity"><i class="fa fa-check"></i><b>3.2</b> Sensitivity</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="model-development.html"><a href="model-development.html#shortwave"><i class="fa fa-check"></i><b>3.2.1</b> Shortwave</a></li>
<li class="chapter" data-level="3.2.2" data-path="model-development.html"><a href="model-development.html#longwave"><i class="fa fa-check"></i><b>3.2.2</b> Longwave</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="model-development.html"><a href="model-development.html#model-calibration"><i class="fa fa-check"></i><b>3.3</b> Model calibration</a></li>
<li class="chapter" data-level="3.4" data-path="model-development.html"><a href="model-development.html#shortwave-1"><i class="fa fa-check"></i><b>3.4</b> Shortwave</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="model-development.html"><a href="model-development.html#longwave-1"><i class="fa fa-check"></i><b>3.4.1</b> Longwave</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="model-results.html"><a href="model-results.html"><i class="fa fa-check"></i><b>4</b> Model results</a>
<ul>
<li class="chapter" data-level="4.1" data-path="model-results.html"><a href="model-results.html#model-output"><i class="fa fa-check"></i><b>4.1</b> Model output</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="model-results.html"><a href="model-results.html#shortwave-2"><i class="fa fa-check"></i><b>4.1.1</b> Shortwave</a></li>
<li class="chapter" data-level="4.1.2" data-path="model-results.html"><a href="model-results.html#longwave-2"><i class="fa fa-check"></i><b>4.1.2</b> Longwave</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="model-results.html"><a href="model-results.html#model-evaluation"><i class="fa fa-check"></i><b>4.2</b> Model evaluation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="model-results.html"><a href="model-results.html#shortwave-3"><i class="fa fa-check"></i><b>4.2.1</b> Shortwave</a></li>
<li class="chapter" data-level="4.2.2" data-path="model-results.html"><a href="model-results.html#longwave-3"><i class="fa fa-check"></i><b>4.2.2</b> Longwave</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="discussion.html"><a href="discussion.html"><i class="fa fa-check"></i><b>5</b> Discussion</a>
<ul>
<li class="chapter" data-level="5.1" data-path="discussion.html"><a href="discussion.html#model-components"><i class="fa fa-check"></i><b>5.1</b> Model components</a>
<ul>
<li class="chapter" data-level="" data-path="discussion.html"><a href="discussion.html#kb"><i class="fa fa-check"></i>Kb</a></li>
<li class="chapter" data-level="" data-path="discussion.html"><a href="discussion.html#kd"><i class="fa fa-check"></i>Kd</a></li>
<li class="chapter" data-level="" data-path="discussion.html"><a href="discussion.html#absorbed-radiation-over-lai"><i class="fa fa-check"></i>Absorbed radiation over LAI</a></li>
<li class="chapter" data-level="" data-path="discussion.html"><a href="discussion.html#emitted-longwave-radiation-at-different-temperature"><i class="fa fa-check"></i>Emitted longwave radiation at different temperature</a></li>
<li class="chapter" data-level="" data-path="discussion.html"><a href="discussion.html#absorbed-radiation-vs-zenith"><i class="fa fa-check"></i>Absorbed radiation vs zenith</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="discussion.html"><a href="discussion.html#conclusion-2"><i class="fa fa-check"></i><b>5.2</b> Conclusion</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="attachements.html"><a href="attachements.html"><i class="fa fa-check"></i><b>6</b> Attachements</a>
<ul>
<li class="chapter" data-level="6.1" data-path="attachements.html"><a href="attachements.html#model-code"><i class="fa fa-check"></i><b>6.1</b> Model code</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="attachements.html"><a href="attachements.html#model-entry-point"><i class="fa fa-check"></i><b>6.1.1</b> Model entry point</a></li>
<li class="chapter" data-level="6.1.2" data-path="attachements.html"><a href="attachements.html#parameter-calculation"><i class="fa fa-check"></i><b>6.1.2</b> Parameter calculation</a></li>
<li class="chapter" data-level="6.1.3" data-path="attachements.html"><a href="attachements.html#shortwave-4"><i class="fa fa-check"></i><b>6.1.3</b> Shortwave</a></li>
<li class="chapter" data-level="6.1.4" data-path="attachements.html"><a href="attachements.html#longwave-4"><i class="fa fa-check"></i><b>6.1.4</b> Longwave</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="attachements.html"><a href="attachements.html#report-code"><i class="fa fa-check"></i><b>6.2</b> Report code</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="attachements.html"><a href="attachements.html#setup"><i class="fa fa-check"></i><b>6.2.1</b> Setup</a></li>
<li class="chapter" data-level="6.2.2" data-path="attachements.html"><a href="attachements.html#markdown"><i class="fa fa-check"></i><b>6.2.2</b> Markdown</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Term paper Radiative Transfer - Ecosystem and Atmosphere Processes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="attachements" class="section level1" number="6">
<h1><span class="header-section-number">Section 6</span> Attachements</h1>
<p>Here all the source code is collected. It is also available on <a href="https://github.com/eap-fes-unigoe/canopy-model/">github</a>.</p>
<div id="model-code" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Model code</h2>
<p>This is the code of the model</p>
<div id="model-entry-point" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Model entry point</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="attachements.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Radiative transfer model</span></span>
<span id="cb1-2"><a href="attachements.html#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="attachements.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;radiative_transfer/shortwave.R&quot;</span>)</span>
<span id="cb1-4"><a href="attachements.html#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;radiative_transfer/longwave.R&quot;</span>)</span>
<span id="cb1-5"><a href="attachements.html#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;radiative_transfer/calc_parameters.R&quot;</span>)</span>
<span id="cb1-6"><a href="attachements.html#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="attachements.html#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="attachements.html#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Radiative transfer model step</span></span>
<span id="cb1-9"><a href="attachements.html#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-10"><a href="attachements.html#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This the core routine of the radiative trasfer model. It calls all the models function</span></span>
<span id="cb1-11"><a href="attachements.html#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-12"><a href="attachements.html#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param input A data frame row (or list) containing at least the following elements</span></span>
<span id="cb1-13"><a href="attachements.html#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - datetime</span></span>
<span id="cb1-14"><a href="attachements.html#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - sw_in total incoming shortwave radiation</span></span>
<span id="cb1-15"><a href="attachements.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - sw_dif diffuse shortwave radiation incoming</span></span>
<span id="cb1-16"><a href="attachements.html#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lw_in longwave radiation incoming</span></span>
<span id="cb1-17"><a href="attachements.html#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-18"><a href="attachements.html#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param state A data frame row (or list) containing at least the following elements</span></span>
<span id="cb1-19"><a href="attachements.html#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - t_soil temperature of soil (in Kelvin)</span></span>
<span id="cb1-20"><a href="attachements.html#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - t_leaf temperature of leaves (in Kelvin)</span></span>
<span id="cb1-21"><a href="attachements.html#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-22"><a href="attachements.html#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param pars a list of the model parameters containing at least the following elements:</span></span>
<span id="cb1-23"><a href="attachements.html#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-24"><a href="attachements.html#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - max LAI value in the summer</span></span>
<span id="cb1-25"><a href="attachements.html#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - min_LAI min value of LAI during winter, it is an aproximation that consider the total Plant Area Index as LAI</span></span>
<span id="cb1-26"><a href="attachements.html#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - leaf_out day leaves start in spring</span></span>
<span id="cb1-27"><a href="attachements.html#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - leaf_full day leaves reach max LAI</span></span>
<span id="cb1-28"><a href="attachements.html#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - leaf_fall day leaves start to fall</span></span>
<span id="cb1-29"><a href="attachements.html#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - leaf_fall_complete day all leaves are fallen</span></span>
<span id="cb1-30"><a href="attachements.html#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-31"><a href="attachements.html#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lat latidude</span></span>
<span id="cb1-32"><a href="attachements.html#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lon longitude</span></span>
<span id="cb1-33"><a href="attachements.html#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-34"><a href="attachements.html#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - rho_leaf Reflencance of leaf</span></span>
<span id="cb1-35"><a href="attachements.html#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - tau_leaf trasmissivity of leaf</span></span>
<span id="cb1-36"><a href="attachements.html#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - omega_leaf scattering coefficient of leaf</span></span>
<span id="cb1-37"><a href="attachements.html#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - clump_OMEGA canopy clumping coefficient</span></span>
<span id="cb1-38"><a href="attachements.html#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - alb_soil_b soil albedo direct beam</span></span>
<span id="cb1-39"><a href="attachements.html#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - alb_soil_d soil albedo diffuse</span></span>
<span id="cb1-40"><a href="attachements.html#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-41"><a href="attachements.html#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - em_leaf emittivity of leaves</span></span>
<span id="cb1-42"><a href="attachements.html#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - em_soil emittivity of soil</span></span>
<span id="cb1-43"><a href="attachements.html#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb1-44"><a href="attachements.html#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return One row data Dataframe with</span></span>
<span id="cb1-45"><a href="attachements.html#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - ic Absorbed shortwave radiation from the canopy</span></span>
<span id="cb1-46"><a href="attachements.html#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - ic_sun Absorbed shortwave radiation from sunlit canopy</span></span>
<span id="cb1-47"><a href="attachements.html#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - ic_sha Absorbed shortwave radiation from shaded canopy</span></span>
<span id="cb1-48"><a href="attachements.html#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - ig Absorbed shortwave radiation from soil</span></span>
<span id="cb1-49"><a href="attachements.html#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - i_up Reflected shortwave radiation above the canopy</span></span>
<span id="cb1-50"><a href="attachements.html#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - i_down Transmitted shortwave radiation below the canopy</span></span>
<span id="cb1-51"><a href="attachements.html#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lc Absorbed longwave radiation from the canopy</span></span>
<span id="cb1-52"><a href="attachements.html#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lc_sun  Absorbed longwave radiation from sunlit canopy</span></span>
<span id="cb1-53"><a href="attachements.html#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lc_sha  Absorbed longwave radiation from shaded canopy</span></span>
<span id="cb1-54"><a href="attachements.html#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - lg Absorbed longwave radiation from the soil</span></span>
<span id="cb1-55"><a href="attachements.html#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - l_up Emitted longwave radiation above the canopy</span></span>
<span id="cb1-56"><a href="attachements.html#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - l_down Transmitted longwave radiation below the canopy</span></span>
<span id="cb1-57"><a href="attachements.html#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - LAI Leaf Area Index</span></span>
<span id="cb1-58"><a href="attachements.html#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; - LAI_sunlit LAI of sunlit canopy</span></span>
<span id="cb1-59"><a href="attachements.html#cb1-59" aria-hidden="true" tabindex="-1"></a>fun_calc_radiative_transfer <span class="ot">&lt;-</span> <span class="cf">function</span>(input, state, pars, dt){</span>
<span id="cb1-60"><a href="attachements.html#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calc all the intermediate parameters</span></span>
<span id="cb1-61"><a href="attachements.html#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Possible optimization here as not all the paramaters changes every step</span></span>
<span id="cb1-62"><a href="attachements.html#cb1-62" aria-hidden="true" tabindex="-1"></a>    LAI <span class="ot">&lt;-</span> <span class="fu">get_day_LAI</span>(input<span class="sc">$</span>datetime, pars<span class="sc">$</span>max_LAI, pars<span class="sc">$</span>leaf_out, pars<span class="sc">$</span>leaf_full, pars<span class="sc">$</span>leaf_fall, pars<span class="sc">$</span>leaf_fall_complete)</span>
<span id="cb1-63"><a href="attachements.html#cb1-63" aria-hidden="true" tabindex="-1"></a>    radiation_PAI <span class="ot">&lt;-</span> <span class="fu">max</span>(LAI, pars<span class="sc">$</span>min_radiation_PAI) <span class="co"># During winter the are no leaves but there are still branches that interact with light</span></span>
<span id="cb1-64"><a href="attachements.html#cb1-64" aria-hidden="true" tabindex="-1"></a>    avg_datetime <span class="ot">&lt;-</span> input<span class="sc">$</span>datetime <span class="sc">-</span> <span class="fu">duration</span>(dt<span class="sc">/</span><span class="dv">2</span>) <span class="co"># calculating the zenith at the mid of the interval</span></span>
<span id="cb1-65"><a href="attachements.html#cb1-65" aria-hidden="true" tabindex="-1"></a>    zenith <span class="ot">&lt;-</span> <span class="fu">get_zenith</span>(avg_datetime, pars<span class="sc">$</span>lat, pars<span class="sc">$</span>lon)</span>
<span id="cb1-66"><a href="attachements.html#cb1-66" aria-hidden="true" tabindex="-1"></a>    Kb <span class="ot">&lt;-</span> <span class="fu">get_Kb</span>(zenith, <span class="at">max_Kb =</span> <span class="dv">1000</span>) <span class="co"># 1000 is an arbitrary high number</span></span>
<span id="cb1-67"><a href="attachements.html#cb1-67" aria-hidden="true" tabindex="-1"></a>    Kd <span class="ot">&lt;-</span> <span class="fu">get_Kd</span>(LAI)</span>
<span id="cb1-68"><a href="attachements.html#cb1-68" aria-hidden="true" tabindex="-1"></a>    omega_leaf <span class="ot">&lt;-</span> pars<span class="sc">$</span>rho_leaf <span class="sc">+</span> pars<span class="sc">$</span>tau_leaf</span>
<span id="cb1-69"><a href="attachements.html#cb1-69" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> <span class="fu">get_beta</span>(pars<span class="sc">$</span>rho_leaf, pars<span class="sc">$</span>tau_leaf)</span>
<span id="cb1-70"><a href="attachements.html#cb1-70" aria-hidden="true" tabindex="-1"></a>    beta0 <span class="ot">&lt;-</span> <span class="fu">get_beta0</span>(zenith, Kb, Kd_2stream, omega_leaf)</span>
<span id="cb1-71"><a href="attachements.html#cb1-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-72"><a href="attachements.html#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the incoming shortwave is the total diffure + direct. Due to sensor errors the difference can be negative so the min possible value is set to 0</span></span>
<span id="cb1-73"><a href="attachements.html#cb1-73" aria-hidden="true" tabindex="-1"></a>    sw_sky_b <span class="ot">&lt;-</span> <span class="fu">max</span>(input<span class="sc">$</span>sw_in <span class="sc">-</span> input<span class="sc">$</span>sw_dif, <span class="dv">0</span>)</span>
<span id="cb1-74"><a href="attachements.html#cb1-74" aria-hidden="true" tabindex="-1"></a>    shortwave <span class="ot">&lt;-</span> <span class="fu">shortwave_radiation</span>(sw_sky_b, input<span class="sc">$</span>sw_dif, radiation_PAI, Kb, Kd_2stream, beta, beta0 , omega_leaf,</span>
<span id="cb1-75"><a href="attachements.html#cb1-75" aria-hidden="true" tabindex="-1"></a>                                     pars<span class="sc">$</span>clump_OMEGA, pars<span class="sc">$</span>alb_soil_b, pars<span class="sc">$</span>alb_soil_d)</span>
<span id="cb1-76"><a href="attachements.html#cb1-76" aria-hidden="true" tabindex="-1"></a>    longwave <span class="ot">&lt;-</span> <span class="fu">longwave_radiation</span>(input<span class="sc">$</span>lw_in, radiation_PAI, state<span class="sc">$</span>t_leaf, state<span class="sc">$</span>t_soil, Kb, Kd, pars<span class="sc">$</span>em_leaf, pars<span class="sc">$</span>em_soil)</span>
<span id="cb1-77"><a href="attachements.html#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="attachements.html#cb1-78" aria-hidden="true" tabindex="-1"></a>    LAI_sunlit <span class="ot">&lt;-</span> <span class="fu">get_LAI_sunlit</span>(LAI, Kb, pars<span class="sc">$</span>clump_OMEGA)</span>
<span id="cb1-79"><a href="attachements.html#cb1-79" aria-hidden="true" tabindex="-1"></a>    LAIs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">LAI=</span>LAI, <span class="at">LAI_sunlit=</span>LAI_sunlit)</span>
<span id="cb1-80"><a href="attachements.html#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="attachements.html#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="fu">c</span>(shortwave, longwave, LAIs)))</span>
<span id="cb1-82"><a href="attachements.html#cb1-82" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-83"><a href="attachements.html#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="co"># The Kd in the Two Stream model has a different value</span></span>
<span id="cb1-84"><a href="attachements.html#cb1-84" aria-hidden="true" tabindex="-1"></a>Kd_2stream <span class="ot">&lt;-</span> <span class="fu">get_two_stream_Kd</span>() <span class="co"># This is a costant value that depends only on the leaf angle distribution</span></span></code></pre></div>
</div>
<div id="parameter-calculation" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Parameter calculation</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="attachements.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pracma) <span class="co"># for rad2deg and deg2rad</span></span>
<span id="cb2-2"><a href="attachements.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(solartime) <span class="co"># for calculating zenith</span></span>
<span id="cb2-3"><a href="attachements.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate) <span class="co"># datetime utils</span></span>
<span id="cb2-4"><a href="attachements.html#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="attachements.html#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="attachements.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Simple model to get current LAI</span></span>
<span id="cb2-7"><a href="attachements.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb2-8"><a href="attachements.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Use a simple model to get the LAI of the different day of the year.</span></span>
<span id="cb2-9"><a href="attachements.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; It has 4 phases:</span></span>
<span id="cb2-10"><a href="attachements.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  - Winter: from leaf_fall_complete to leaf_out -&gt; LAI = 0</span></span>
<span id="cb2-11"><a href="attachements.html#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  - Spring: from leaf_out to leaf_full -&gt; linear growth from 0 to max_LAI</span></span>
<span id="cb2-12"><a href="attachements.html#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  - Summer: from leaf_full to leaf_fall -&gt; LAI = max_LAI</span></span>
<span id="cb2-13"><a href="attachements.html#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  - Fall: from leaf_fall to leaf_fall_complete -&gt; linear decrease from max_LAI to 0</span></span>
<span id="cb2-14"><a href="attachements.html#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; The 4 paramenters (leaf_out...) are the day of the year</span></span>
<span id="cb2-15"><a href="attachements.html#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb2-16"><a href="attachements.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param time a datetime object</span></span>
<span id="cb2-17"><a href="attachements.html#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param max_LAI max LAI value in the summer</span></span>
<span id="cb2-18"><a href="attachements.html#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param leaf_out day leaves start in spring</span></span>
<span id="cb2-19"><a href="attachements.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param leaf_full day leaves reach max LAI</span></span>
<span id="cb2-20"><a href="attachements.html#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param leaf_fall day leaves start to fall</span></span>
<span id="cb2-21"><a href="attachements.html#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param leaf_fall_complete day all leaves are fallen</span></span>
<span id="cb2-22"><a href="attachements.html#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb2-23"><a href="attachements.html#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return LAI Leaf Area Index value for the day of the year</span></span>
<span id="cb2-24"><a href="attachements.html#cb2-24" aria-hidden="true" tabindex="-1"></a>get_day_LAI <span class="ot">&lt;-</span> <span class="cf">function</span>(datetime, max_LAI, leaf_out, leaf_full, leaf_fall, leaf_fall_complete) {</span>
<span id="cb2-25"><a href="attachements.html#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="attachements.html#cb2-26" aria-hidden="true" tabindex="-1"></a>  yday <span class="ot">&lt;-</span> <span class="fu">yday</span>(datetime)</span>
<span id="cb2-27"><a href="attachements.html#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (yday <span class="sc">&lt;</span> leaf_out) { <span class="co"># before leaves are out LAI is min</span></span>
<span id="cb2-28"><a href="attachements.html#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb2-29"><a href="attachements.html#cb2-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-30"><a href="attachements.html#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (yday <span class="sc">&gt;=</span> leaf_out <span class="sc">&amp;</span> yday <span class="sc">&lt;</span> leaf_full) {</span>
<span id="cb2-31"><a href="attachements.html#cb2-31" aria-hidden="true" tabindex="-1"></a>    ndays <span class="ot">&lt;-</span> leaf_full <span class="sc">-</span> leaf_out <span class="co"># n days of the transition</span></span>
<span id="cb2-32"><a href="attachements.html#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(max_LAI <span class="sc">*</span> (yday <span class="sc">-</span> leaf_out) <span class="sc">/</span> ndays)</span>
<span id="cb2-33"><a href="attachements.html#cb2-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-34"><a href="attachements.html#cb2-34" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (yday <span class="sc">&gt;=</span> leaf_full <span class="sc">&amp;</span> yday <span class="sc">&lt;</span> leaf_fall) {</span>
<span id="cb2-35"><a href="attachements.html#cb2-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(max_LAI)</span>
<span id="cb2-36"><a href="attachements.html#cb2-36" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-37"><a href="attachements.html#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (yday <span class="sc">&gt;=</span> leaf_fall <span class="sc">&amp;</span> yday <span class="sc">&lt;</span> leaf_fall_complete) {</span>
<span id="cb2-38"><a href="attachements.html#cb2-38" aria-hidden="true" tabindex="-1"></a>    ndays <span class="ot">&lt;-</span> leaf_fall_complete <span class="sc">-</span> leaf_fall <span class="co"># n days of the transition</span></span>
<span id="cb2-39"><a href="attachements.html#cb2-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(max_LAI <span class="sc">*</span> (leaf_fall_complete <span class="sc">-</span> yday) <span class="sc">/</span> ndays)</span>
<span id="cb2-40"><a href="attachements.html#cb2-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-41"><a href="attachements.html#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (yday <span class="sc">&gt;=</span> leaf_fall_complete) {</span>
<span id="cb2-42"><a href="attachements.html#cb2-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">0</span>)</span>
<span id="cb2-43"><a href="attachements.html#cb2-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-44"><a href="attachements.html#cb2-44" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-45"><a href="attachements.html#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="attachements.html#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Solar zenith from datetime and geographical coordinates</span></span>
<span id="cb2-47"><a href="attachements.html#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb2-48"><a href="attachements.html#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param time Datetime object with the current time</span></span>
<span id="cb2-49"><a href="attachements.html#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lon Longitude</span></span>
<span id="cb2-50"><a href="attachements.html#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lat Latidute</span></span>
<span id="cb2-51"><a href="attachements.html#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb2-52"><a href="attachements.html#cb2-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return solar zenith (in degrees) between 0 and 90 </span></span>
<span id="cb2-53"><a href="attachements.html#cb2-53" aria-hidden="true" tabindex="-1"></a>get_zenith <span class="ot">&lt;-</span> <span class="cf">function</span>(time, lat, lon) {</span>
<span id="cb2-54"><a href="attachements.html#cb2-54" aria-hidden="true" tabindex="-1"></a>  elevation <span class="ot">&lt;-</span> <span class="fu">computeSunPosition</span>(time, lat, lon)[<span class="dv">3</span>]</span>
<span id="cb2-55"><a href="attachements.html#cb2-55" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">&lt;-</span> <span class="dv">90</span> <span class="sc">-</span> <span class="fu">rad2deg</span>(elevation)</span>
<span id="cb2-56"><a href="attachements.html#cb2-56" aria-hidden="true" tabindex="-1"></a>  Z <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">90</span>, Z) <span class="co"># avoid zenith values below horizon</span></span>
<span id="cb2-57"><a href="attachements.html#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Z)</span>
<span id="cb2-58"><a href="attachements.html#cb2-58" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-59"><a href="attachements.html#cb2-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-60"><a href="attachements.html#cb2-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-61"><a href="attachements.html#cb2-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;  All the following function assumes a SPHERICAL leaves distribution</span></span>
<span id="cb2-62"><a href="attachements.html#cb2-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Chapter 2.2</span></span>
<span id="cb2-63"><a href="attachements.html#cb2-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-64"><a href="attachements.html#cb2-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-65"><a href="attachements.html#cb2-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Direct beam extiction coefficient</span></span>
<span id="cb2-66"><a href="attachements.html#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param zenith in degrees</span></span>
<span id="cb2-67"><a href="attachements.html#cb2-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Kb</span></span>
<span id="cb2-68"><a href="attachements.html#cb2-68" aria-hidden="true" tabindex="-1"></a>get_Kb <span class="ot">&lt;-</span> <span class="cf">function</span>(zenith, <span class="at">max_Kb =</span> <span class="dv">20</span>) {</span>
<span id="cb2-69"><a href="attachements.html#cb2-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq. 14.29</span></span>
<span id="cb2-70"><a href="attachements.html#cb2-70" aria-hidden="true" tabindex="-1"></a>  Kb <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">/</span> <span class="fu">cos</span>(<span class="fu">deg2rad</span>(zenith)) <span class="co"># extinction coefficient</span></span>
<span id="cb2-71"><a href="attachements.html#cb2-71" aria-hidden="true" tabindex="-1"></a>  Kb <span class="ot">&lt;-</span> <span class="fu">min</span>(Kb, max_Kb) <span class="co"># Prevent the Kb to become too large at low sun angles.</span></span>
<span id="cb2-72"><a href="attachements.html#cb2-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># The default value of 20 is from the Bonan matlab code script sp_14_03 line 150</span></span>
<span id="cb2-73"><a href="attachements.html#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Kb)</span>
<span id="cb2-74"><a href="attachements.html#cb2-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-75"><a href="attachements.html#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="attachements.html#cb2-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Diffuse radiation extiction coefficient</span></span>
<span id="cb2-77"><a href="attachements.html#cb2-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param LAI</span></span>
<span id="cb2-78"><a href="attachements.html#cb2-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Kd</span></span>
<span id="cb2-79"><a href="attachements.html#cb2-79" aria-hidden="true" tabindex="-1"></a>get_Kd <span class="ot">&lt;-</span> <span class="cf">function</span>(LAI) {</span>
<span id="cb2-80"><a href="attachements.html#cb2-80" aria-hidden="true" tabindex="-1"></a>  G_z <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-81"><a href="attachements.html#cb2-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-82"><a href="attachements.html#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq. 14.33</span></span>
<span id="cb2-83"><a href="attachements.html#cb2-83" aria-hidden="true" tabindex="-1"></a>  td <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-84"><a href="attachements.html#cb2-84" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (z <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">0</span>, pi <span class="sc">/</span> <span class="dv">4</span>, pi <span class="sc">/</span> <span class="dv">18</span>)) { <span class="co"># make 9 steps from 0 till pi/2</span></span>
<span id="cb2-85"><a href="attachements.html#cb2-85" aria-hidden="true" tabindex="-1"></a>    td <span class="ot">&lt;-</span> td <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>G_z <span class="sc">/</span> <span class="fu">cos</span>(z) <span class="sc">*</span> LAI) <span class="sc">*</span></span>
<span id="cb2-86"><a href="attachements.html#cb2-86" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sin</span>(z) <span class="sc">*</span></span>
<span id="cb2-87"><a href="attachements.html#cb2-87" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cos</span>(z) <span class="sc">*</span></span>
<span id="cb2-88"><a href="attachements.html#cb2-88" aria-hidden="true" tabindex="-1"></a>      (pi <span class="sc">/</span> <span class="dv">18</span>)</span>
<span id="cb2-89"><a href="attachements.html#cb2-89" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-90"><a href="attachements.html#cb2-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-91"><a href="attachements.html#cb2-91" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq 14.34</span></span>
<span id="cb2-92"><a href="attachements.html#cb2-92" aria-hidden="true" tabindex="-1"></a>  Kd <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">log</span>(<span class="dv">2</span> <span class="sc">*</span> td) <span class="sc">/</span> LAI</span>
<span id="cb2-93"><a href="attachements.html#cb2-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Kd)</span>
<span id="cb2-94"><a href="attachements.html#cb2-94" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-95"><a href="attachements.html#cb2-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-96"><a href="attachements.html#cb2-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Diffuse radiation extiction coefficient for the 2 stream aproxmiation</span></span>
<span id="cb2-97"><a href="attachements.html#cb2-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This depends only on the leaf angle distribution</span></span>
<span id="cb2-98"><a href="attachements.html#cb2-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param LAI</span></span>
<span id="cb2-99"><a href="attachements.html#cb2-99" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return Kd</span></span>
<span id="cb2-100"><a href="attachements.html#cb2-100" aria-hidden="true" tabindex="-1"></a>get_two_stream_Kd <span class="ot">&lt;-</span> <span class="cf">function</span>() {</span>
<span id="cb2-101"><a href="attachements.html#cb2-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq. 14.31</span></span>
<span id="cb2-102"><a href="attachements.html#cb2-102" aria-hidden="true" tabindex="-1"></a>  ross <span class="ot">&lt;-</span> <span class="fl">0.01</span> <span class="co"># should be zero but if is zero it mess up the computations.</span></span>
<span id="cb2-103"><a href="attachements.html#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># See Bonan matlab code script sp_14_03 line 130</span></span>
<span id="cb2-104"><a href="attachements.html#cb2-104" aria-hidden="true" tabindex="-1"></a>  phi_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">-</span> <span class="fl">0.633</span> <span class="sc">*</span> ross <span class="sc">-</span> <span class="fl">0.333</span> <span class="sc">*</span> (ross)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb2-105"><a href="attachements.html#cb2-105" aria-hidden="true" tabindex="-1"></a>  phi_2 <span class="ot">&lt;-</span> <span class="fl">0.877</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> phi_1)</span>
<span id="cb2-106"><a href="attachements.html#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq 14.80</span></span>
<span id="cb2-107"><a href="attachements.html#cb2-107" aria-hidden="true" tabindex="-1"></a>  Kd <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> ((<span class="dv">1</span> <span class="sc">-</span> phi_1 <span class="sc">/</span> phi_2 <span class="sc">*</span> <span class="fu">log</span>((phi_1 <span class="sc">+</span> phi_2) <span class="sc">/</span> phi_1)) <span class="sc">/</span> phi_2)</span>
<span id="cb2-108"><a href="attachements.html#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(Kd)</span>
<span id="cb2-109"><a href="attachements.html#cb2-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-110"><a href="attachements.html#cb2-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-111"><a href="attachements.html#cb2-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-112"><a href="attachements.html#cb2-112" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Fraction of diffuse light scattered backward</span></span>
<span id="cb2-113"><a href="attachements.html#cb2-113" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param rho_leaf</span></span>
<span id="cb2-114"><a href="attachements.html#cb2-114" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param tau_leaf</span></span>
<span id="cb2-115"><a href="attachements.html#cb2-115" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; </span></span>
<span id="cb2-116"><a href="attachements.html#cb2-116" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return beta</span></span>
<span id="cb2-117"><a href="attachements.html#cb2-117" aria-hidden="true" tabindex="-1"></a>get_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(rho_leaf, tau_leaf) {</span>
<span id="cb2-118"><a href="attachements.html#cb2-118" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Derived from equations 14.81 following the book approximation for sperical distribution</span></span>
<span id="cb2-119"><a href="attachements.html#cb2-119" aria-hidden="true" tabindex="-1"></a>  beta <span class="ot">&lt;-</span> (<span class="fl">0.625</span> <span class="sc">*</span> rho_leaf <span class="sc">+</span> <span class="fl">0.375</span> <span class="sc">*</span> tau_leaf) <span class="sc">/</span> (rho_leaf <span class="sc">+</span> tau_leaf)</span>
<span id="cb2-120"><a href="attachements.html#cb2-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta)</span>
<span id="cb2-121"><a href="attachements.html#cb2-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-122"><a href="attachements.html#cb2-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-123"><a href="attachements.html#cb2-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-124"><a href="attachements.html#cb2-124" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Fraction of direct light scattered backward</span></span>
<span id="cb2-125"><a href="attachements.html#cb2-125" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param zenith in degrees</span></span>
<span id="cb2-126"><a href="attachements.html#cb2-126" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kb</span></span>
<span id="cb2-127"><a href="attachements.html#cb2-127" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kd</span></span>
<span id="cb2-128"><a href="attachements.html#cb2-128" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param omega_leaf</span></span>
<span id="cb2-129"><a href="attachements.html#cb2-129" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb2-130"><a href="attachements.html#cb2-130" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return beta0</span></span>
<span id="cb2-131"><a href="attachements.html#cb2-131" aria-hidden="true" tabindex="-1"></a>get_beta0 <span class="ot">&lt;-</span> <span class="cf">function</span>(zenith, Kb, Kd, omega_leaf) {</span>
<span id="cb2-132"><a href="attachements.html#cb2-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-133"><a href="attachements.html#cb2-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq. 14.31</span></span>
<span id="cb2-134"><a href="attachements.html#cb2-134" aria-hidden="true" tabindex="-1"></a>  ross <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-135"><a href="attachements.html#cb2-135" aria-hidden="true" tabindex="-1"></a>  phi_1 <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="sc">-</span> <span class="fl">0.633</span> <span class="sc">*</span> ross <span class="sc">-</span> <span class="fl">0.333</span> <span class="sc">*</span> (ross)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb2-136"><a href="attachements.html#cb2-136" aria-hidden="true" tabindex="-1"></a>  phi_2 <span class="ot">&lt;-</span> <span class="fl">0.877</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> phi_1)</span>
<span id="cb2-137"><a href="attachements.html#cb2-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-138"><a href="attachements.html#cb2-138" aria-hidden="true" tabindex="-1"></a>  G_mu <span class="ot">&lt;-</span> <span class="fl">0.5</span> <span class="co">#mu is cos(Z) but G(Z) for sperical leaves distribution is costant</span></span>
<span id="cb2-139"><a href="attachements.html#cb2-139" aria-hidden="true" tabindex="-1"></a>  mu <span class="ot">&lt;-</span> <span class="fu">cos</span>(<span class="fu">deg2rad</span>(zenith))</span>
<span id="cb2-140"><a href="attachements.html#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="attachements.html#cb2-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Equation 14.84</span></span>
<span id="cb2-142"><a href="attachements.html#cb2-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-143"><a href="attachements.html#cb2-143" aria-hidden="true" tabindex="-1"></a>  <span class="co">#defining commonly used terms</span></span>
<span id="cb2-144"><a href="attachements.html#cb2-144" aria-hidden="true" tabindex="-1"></a>  mphi_1 <span class="ot">&lt;-</span> mu <span class="sc">*</span> phi_1</span>
<span id="cb2-145"><a href="attachements.html#cb2-145" aria-hidden="true" tabindex="-1"></a>  mphi_2 <span class="ot">&lt;-</span> mu <span class="sc">*</span> phi_2</span>
<span id="cb2-146"><a href="attachements.html#cb2-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-147"><a href="attachements.html#cb2-147" aria-hidden="true" tabindex="-1"></a>  a_s <span class="ot">&lt;-</span> (</span>
<span id="cb2-148"><a href="attachements.html#cb2-148" aria-hidden="true" tabindex="-1"></a>    (omega_leaf <span class="sc">/</span> <span class="dv">2</span>) <span class="sc">*</span> (G_mu) <span class="sc">/</span> (G_mu <span class="sc">+</span> mphi_2) <span class="sc">*</span></span>
<span id="cb2-149"><a href="attachements.html#cb2-149" aria-hidden="true" tabindex="-1"></a>      (<span class="dv">1</span> <span class="sc">-</span> (mphi_1 <span class="sc">/</span> (G_mu <span class="sc">+</span> mphi_2) <span class="sc">*</span> <span class="fu">log</span>((G_mu <span class="sc">+</span> mphi_1 <span class="sc">+</span> mphi_2) <span class="sc">/</span> mphi_1)))</span>
<span id="cb2-150"><a href="attachements.html#cb2-150" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-151"><a href="attachements.html#cb2-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-152"><a href="attachements.html#cb2-152" aria-hidden="true" tabindex="-1"></a>  beta_0 <span class="ot">&lt;-</span> (((Kb <span class="sc">+</span> Kd) <span class="sc">/</span> Kb) <span class="sc">*</span> a_s) <span class="sc">/</span> omega_leaf</span>
<span id="cb2-153"><a href="attachements.html#cb2-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(beta_0)</span>
<span id="cb2-154"><a href="attachements.html#cb2-154" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-155"><a href="attachements.html#cb2-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-156"><a href="attachements.html#cb2-156" aria-hidden="true" tabindex="-1"></a>get_LAI_sunlit <span class="ot">&lt;-</span> <span class="cf">function</span>(LAI, Kb, clump_OMEGA) {</span>
<span id="cb2-157"><a href="attachements.html#cb2-157" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Eq.14.18 integrated in the same way of Eq. 14.12 (also line in Bonan Matlab code line script sp_14_03 line 167)</span></span>
<span id="cb2-158"><a href="attachements.html#cb2-158" aria-hidden="true" tabindex="-1"></a>  LAI_sunlit <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>clump_OMEGA <span class="sc">*</span> Kb <span class="sc">*</span> LAI)) <span class="sc">/</span> Kb</span>
<span id="cb2-159"><a href="attachements.html#cb2-159" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(LAI_sunlit)</span>
<span id="cb2-160"><a href="attachements.html#cb2-160" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="shortwave-4" class="section level3" number="6.1.3">
<h3><span class="header-section-number">6.1.3</span> Shortwave</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="attachements.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="do">## solving for direct/diffuse shortwave using the two stream approximation</span></span>
<span id="cb3-2"><a href="attachements.html#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="attachements.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the direct shortwave radiation absorbed by the canopy with sunlit and shaded components</span></span>
<span id="cb3-4"><a href="attachements.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sw_sky_b direct beam radiation above the canopy in W m-2</span></span>
<span id="cb3-5"><a href="attachements.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param LAI Leaf Area Index</span></span>
<span id="cb3-6"><a href="attachements.html#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kb Direct beam extiction coefficient</span></span>
<span id="cb3-7"><a href="attachements.html#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kd Diffuse exiction coefficient</span></span>
<span id="cb3-8"><a href="attachements.html#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta Fraction of diffuse radiation upward scattered</span></span>
<span id="cb3-9"><a href="attachements.html#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta0 Fraction of direct beam radiation upward scattered</span></span>
<span id="cb3-10"><a href="attachements.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param omega_leaf Leaf scattering coefficient (reflectace + trasmittance)</span></span>
<span id="cb3-11"><a href="attachements.html#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clump_OMEGA Canopy clumping coefficient</span></span>
<span id="cb3-12"><a href="attachements.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param alb_soil_b Albedo soil for direct beam radiation</span></span>
<span id="cb3-13"><a href="attachements.html#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb3-14"><a href="attachements.html#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return list of ic, ic_sun, ic_sha</span></span>
<span id="cb3-15"><a href="attachements.html#cb3-15" aria-hidden="true" tabindex="-1"></a>direct_beam_radiation <span class="ot">&lt;-</span> <span class="cf">function</span>(sw_sky_b, LAI, Kb, Kd, beta, beta0, omega_leaf, clump_OMEGA, alb_soil_b, alb_soil_d){</span>
<span id="cb3-16"><a href="attachements.html#cb3-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-17"><a href="attachements.html#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># defining common terms between direct/diffuse</span></span>
<span id="cb3-18"><a href="attachements.html#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Common terms: Eqs. (14.87) - (14.91)</span></span>
<span id="cb3-19"><a href="attachements.html#cb3-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-20"><a href="attachements.html#cb3-20" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">*</span> omega_leaf) <span class="sc">*</span> Kd</span>
<span id="cb3-21"><a href="attachements.html#cb3-21" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> beta <span class="sc">*</span> omega_leaf <span class="sc">*</span> Kd</span>
<span id="cb3-22"><a href="attachements.html#cb3-22" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(b<span class="sc">*</span>b <span class="sc">-</span> c<span class="sc">*</span>c)</span>
<span id="cb3-23"><a href="attachements.html#cb3-23" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> (h <span class="sc">-</span> b <span class="sc">-</span> c) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> h)</span>
<span id="cb3-24"><a href="attachements.html#cb3-24" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> (h <span class="sc">+</span> b <span class="sc">+</span> c) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> h)</span>
<span id="cb3-25"><a href="attachements.html#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">#d = omega(p,ib) * Kb(p) * atmos.swskyb(p,ib) / (h*h - Kb(p)*Kb(p));</span></span>
<span id="cb3-26"><a href="attachements.html#cb3-26" aria-hidden="true" tabindex="-1"></a>  g1 <span class="ot">&lt;-</span> ((beta0 <span class="sc">*</span> Kb <span class="sc">-</span> b <span class="sc">*</span> beta0 <span class="sc">-</span> c <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta0)) <span class="sc">*</span></span>
<span id="cb3-27"><a href="attachements.html#cb3-27" aria-hidden="true" tabindex="-1"></a>         omega_leaf <span class="sc">*</span> Kb <span class="sc">*</span> sw_sky_b <span class="sc">/</span> (h<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> Kb<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb3-28"><a href="attachements.html#cb3-28" aria-hidden="true" tabindex="-1"></a>  g2 <span class="ot">&lt;-</span> ((<span class="dv">1</span> <span class="sc">-</span> beta0) <span class="sc">*</span> Kb <span class="sc">+</span> c <span class="sc">*</span> beta0 <span class="sc">+</span> b <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> beta0)) <span class="sc">*</span> omega_leaf <span class="sc">*</span> Kb <span class="sc">*</span> sw_sky_b <span class="sc">/</span> (h<span class="sc">*</span>h <span class="sc">-</span> Kb<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb3-29"><a href="attachements.html#cb3-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-30"><a href="attachements.html#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Exponential functions of leaf area</span></span>
<span id="cb3-31"><a href="attachements.html#cb3-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-32"><a href="attachements.html#cb3-32" aria-hidden="true" tabindex="-1"></a>  s1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span>h <span class="sc">*</span> clump_OMEGA <span class="sc">*</span> x);</span>
<span id="cb3-33"><a href="attachements.html#cb3-33" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span> Kb <span class="sc">*</span> clump_OMEGA <span class="sc">*</span> x)</span>
<span id="cb3-34"><a href="attachements.html#cb3-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-35"><a href="attachements.html#cb3-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-36"><a href="attachements.html#cb3-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-37"><a href="attachements.html#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Direct beam solution</span></span>
<span id="cb3-38"><a href="attachements.html#cb3-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n1 (Eq. 14.92) and n2 (14.93)</span></span>
<span id="cb3-39"><a href="attachements.html#cb3-39" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-40"><a href="attachements.html#cb3-40" aria-hidden="true" tabindex="-1"></a>  num1 <span class="ot">&lt;-</span> v <span class="sc">*</span> (g1 <span class="sc">+</span> g2 <span class="sc">*</span> alb_soil_b <span class="sc">+</span> alb_soil_b <span class="sc">*</span> sw_sky_b) <span class="sc">*</span> <span class="fu">s2</span>(LAI)</span>
<span id="cb3-41"><a href="attachements.html#cb3-41" aria-hidden="true" tabindex="-1"></a>  num2 <span class="ot">&lt;-</span> g2 <span class="sc">*</span> (u <span class="sc">+</span> v <span class="sc">*</span> alb_soil_b) <span class="sc">*</span> <span class="fu">s1</span>(LAI)</span>
<span id="cb3-42"><a href="attachements.html#cb3-42" aria-hidden="true" tabindex="-1"></a>  den1 <span class="ot">&lt;-</span> v <span class="sc">*</span> (v <span class="sc">+</span> u <span class="sc">*</span> alb_soil_b) <span class="sc">/</span> <span class="fu">s1</span>(LAI)</span>
<span id="cb3-43"><a href="attachements.html#cb3-43" aria-hidden="true" tabindex="-1"></a>  den2 <span class="ot">&lt;-</span> u <span class="sc">*</span> (u <span class="sc">+</span> v <span class="sc">*</span> alb_soil_b) <span class="sc">*</span> <span class="fu">s1</span>(LAI)</span>
<span id="cb3-44"><a href="attachements.html#cb3-44" aria-hidden="true" tabindex="-1"></a>  n2b <span class="ot">&lt;-</span> (num1 <span class="sc">-</span> num2) <span class="sc">/</span> (den1 <span class="sc">-</span> den2)</span>
<span id="cb3-45"><a href="attachements.html#cb3-45" aria-hidden="true" tabindex="-1"></a>  n1b <span class="ot">&lt;-</span> (g2 <span class="sc">-</span> n2b <span class="sc">*</span> u) <span class="sc">/</span> v</span>
<span id="cb3-46"><a href="attachements.html#cb3-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-47"><a href="attachements.html#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scattered direct beam fluxes:</span></span>
<span id="cb3-48"><a href="attachements.html#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># iupwb - direct beam flux scattered upward above cumulative LAI (W/m2); Eq. (14.94)</span></span>
<span id="cb3-49"><a href="attachements.html#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># idwnb - direct beam flux scattered downward below cumulative LAI (W/m2); Eq. (14.95)</span></span>
<span id="cb3-50"><a href="attachements.html#cb3-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-51"><a href="attachements.html#cb3-51" aria-hidden="true" tabindex="-1"></a>  i_upw_b <span class="ot">&lt;-</span>  <span class="cf">function</span>(x) <span class="sc">-</span>g1 <span class="sc">*</span> <span class="fu">s2</span>(x) <span class="sc">+</span> n1b <span class="sc">*</span> u <span class="sc">*</span> <span class="fu">s1</span>(x) <span class="sc">+</span> n2b <span class="sc">*</span> v <span class="sc">/</span> <span class="fu">s1</span>(x)</span>
<span id="cb3-52"><a href="attachements.html#cb3-52" aria-hidden="true" tabindex="-1"></a>  i_dwn_b <span class="ot">&lt;-</span>  <span class="cf">function</span>(x)  g2 <span class="sc">*</span> <span class="fu">s2</span>(x) <span class="sc">-</span> n1b <span class="sc">*</span> v <span class="sc">*</span> <span class="fu">s1</span>(x) <span class="sc">-</span> n2b <span class="sc">*</span> u <span class="sc">/</span> <span class="fu">s1</span>(x)</span>
<span id="cb3-53"><a href="attachements.html#cb3-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-54"><a href="attachements.html#cb3-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># icb - direct beam flux absorbed by canopy (W/m2); Eq. (14.97)</span></span>
<span id="cb3-55"><a href="attachements.html#cb3-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-56"><a href="attachements.html#cb3-56" aria-hidden="true" tabindex="-1"></a>  ic_b <span class="ot">&lt;-</span> sw_sky_b <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)) <span class="sc">-</span> <span class="fu">i_upw_b</span>(<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">i_upw_b</span>(LAI) <span class="sc">-</span> <span class="fu">i_dwn_b</span>(LAI)</span>
<span id="cb3-57"><a href="attachements.html#cb3-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-58"><a href="attachements.html#cb3-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ig_b - direct beam flux absorbed by the soil; Eq 14.98</span></span>
<span id="cb3-59"><a href="attachements.html#cb3-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-60"><a href="attachements.html#cb3-60" aria-hidden="true" tabindex="-1"></a>  ig_b <span class="ot">&lt;-</span> ((<span class="dv">1</span><span class="sc">-</span> alb_soil_d) <span class="sc">*</span> <span class="fu">i_dwn_b</span>(LAI)) <span class="sc">+</span> ((<span class="dv">1</span> <span class="sc">-</span> alb_soil_b) <span class="sc">*</span> sw_sky_b <span class="sc">*</span> <span class="fu">s2</span>(LAI))</span>
<span id="cb3-61"><a href="attachements.html#cb3-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-62"><a href="attachements.html#cb3-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># icsunb - direct beam flux absorbed by sunlit canopy (W/m2); Eq. (14.114)</span></span>
<span id="cb3-63"><a href="attachements.html#cb3-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># icshab - direct beam flux absorbed by shaded canopy (W/m2); Eq. (14.115)</span></span>
<span id="cb3-64"><a href="attachements.html#cb3-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-65"><a href="attachements.html#cb3-65" aria-hidden="true" tabindex="-1"></a>  a1b <span class="ot">&lt;-</span> <span class="sc">-</span>g1 <span class="sc">*</span>      (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">*</span><span class="fu">s2</span>(LAI)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> Kb) <span class="sc">+</span> </span>
<span id="cb3-66"><a href="attachements.html#cb3-66" aria-hidden="true" tabindex="-1"></a>    n1b <span class="sc">*</span> u <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">*</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">+</span> h) <span class="sc">+</span> n2b <span class="sc">*</span> v <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">/</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">-</span> h)</span>
<span id="cb3-67"><a href="attachements.html#cb3-67" aria-hidden="true" tabindex="-1"></a>  a2b <span class="ot">&lt;-</span>  g2 <span class="sc">*</span>      (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">*</span><span class="fu">s2</span>(LAI)) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> Kb) <span class="sc">-</span></span>
<span id="cb3-68"><a href="attachements.html#cb3-68" aria-hidden="true" tabindex="-1"></a>    n1b <span class="sc">*</span> v <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">*</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">+</span> h) <span class="sc">-</span> n2b <span class="sc">*</span> u <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">/</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">-</span> h)</span>
<span id="cb3-69"><a href="attachements.html#cb3-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-70"><a href="attachements.html#cb3-70" aria-hidden="true" tabindex="-1"></a>  ic_sun_b <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> omega_leaf) <span class="sc">*</span> ((<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)) <span class="sc">*</span> sw_sky_b <span class="sc">+</span> Kd <span class="sc">*</span> (a1b <span class="sc">+</span> a2b) <span class="sc">*</span> clump_OMEGA)</span>
<span id="cb3-71"><a href="attachements.html#cb3-71" aria-hidden="true" tabindex="-1"></a>  ic_sha_b <span class="ot">&lt;-</span> ic_b <span class="sc">-</span> ic_sun_b</span>
<span id="cb3-72"><a href="attachements.html#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="attachements.html#cb3-73" aria-hidden="true" tabindex="-1"></a>  i_up_b <span class="ot">&lt;-</span> <span class="fu">i_upw_b</span>(<span class="dv">0</span>)</span>
<span id="cb3-74"><a href="attachements.html#cb3-74" aria-hidden="true" tabindex="-1"></a>  i_down_b <span class="ot">&lt;-</span> <span class="fu">i_dwn_b</span>(LAI)</span>
<span id="cb3-75"><a href="attachements.html#cb3-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-76"><a href="attachements.html#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ic_b =</span> ic_b, <span class="at">ic_sun_b=</span>ic_sun_b, <span class="at">ic_sha_b=</span>ic_sha_b, <span class="at">ig_b =</span> ig_b, <span class="at">i_up_b =</span> i_up_b, <span class="at">i_down_b =</span> i_down_b))</span>
<span id="cb3-77"><a href="attachements.html#cb3-77" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-78"><a href="attachements.html#cb3-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-79"><a href="attachements.html#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the diffuse shortwave radiation absorbed by the canopy with sunlit and shaded components</span></span>
<span id="cb3-80"><a href="attachements.html#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sw_sky_d diffuse radiation above the canopy in W m-2</span></span>
<span id="cb3-81"><a href="attachements.html#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param LAI Leaf Area Index</span></span>
<span id="cb3-82"><a href="attachements.html#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kb Direct beam extiction coefficient</span></span>
<span id="cb3-83"><a href="attachements.html#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kd Diffuse exiction coefficient</span></span>
<span id="cb3-84"><a href="attachements.html#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta Fraction of diffuse radiation upward scattered</span></span>
<span id="cb3-85"><a href="attachements.html#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta0 Fraction of direct beam radiation upward scattered</span></span>
<span id="cb3-86"><a href="attachements.html#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param omega_leaf Leaf scattering coefficient (reflectace + trasmittance)</span></span>
<span id="cb3-87"><a href="attachements.html#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clump_OMEGA Canopy clumping coefficient</span></span>
<span id="cb3-88"><a href="attachements.html#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param alb_soil_d Albedo soil for diffuse radiation</span></span>
<span id="cb3-89"><a href="attachements.html#cb3-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb3-90"><a href="attachements.html#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return list of ic, ic_sun, ic_sha, ig, i_up_d, i_down_d</span></span>
<span id="cb3-91"><a href="attachements.html#cb3-91" aria-hidden="true" tabindex="-1"></a>diffuse_radiation <span class="ot">&lt;-</span> <span class="cf">function</span>(sw_sky_d, LAI, Kb, Kd, beta, beta0, omega_leaf, clump_OMEGA, alb_soil_d){</span>
<span id="cb3-92"><a href="attachements.html#cb3-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-93"><a href="attachements.html#cb3-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># defining common terms between direct/diffuse</span></span>
<span id="cb3-94"><a href="attachements.html#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Common terms: Eqs. (14.87) - (14.91)</span></span>
<span id="cb3-95"><a href="attachements.html#cb3-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-96"><a href="attachements.html#cb3-96" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> (<span class="dv">1</span> <span class="sc">-</span> beta) <span class="sc">*</span> omega_leaf) <span class="sc">*</span> Kd</span>
<span id="cb3-97"><a href="attachements.html#cb3-97" aria-hidden="true" tabindex="-1"></a>  c <span class="ot">&lt;-</span> beta <span class="sc">*</span> omega_leaf <span class="sc">*</span> Kd</span>
<span id="cb3-98"><a href="attachements.html#cb3-98" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(b<span class="sc">*</span>b <span class="sc">-</span> c<span class="sc">*</span>c)</span>
<span id="cb3-99"><a href="attachements.html#cb3-99" aria-hidden="true" tabindex="-1"></a>  u <span class="ot">&lt;-</span> (h <span class="sc">-</span> b <span class="sc">-</span> c) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> h)</span>
<span id="cb3-100"><a href="attachements.html#cb3-100" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> (h <span class="sc">+</span> b <span class="sc">+</span> c) <span class="sc">/</span> (<span class="dv">2</span> <span class="sc">*</span> h) </span>
<span id="cb3-101"><a href="attachements.html#cb3-101" aria-hidden="true" tabindex="-1"></a>  <span class="co">#g1 &lt;- ((beta0 * Kb - b * beta0 - c * (1 - beta0))</span></span>
<span id="cb3-102"><a href="attachements.html#cb3-102" aria-hidden="true" tabindex="-1"></a>  <span class="co">#       * omega_leaf * Kb * sw_sky_d / (h^2 - Kb^2))</span></span>
<span id="cb3-103"><a href="attachements.html#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">#g2 &lt;- ((1 - beta0) * Kb + c * beta0 + b * (1 - beta0)) * omega_leaf * Kb * sw_sky_d / (h*h - Kb^2)</span></span>
<span id="cb3-104"><a href="attachements.html#cb3-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-105"><a href="attachements.html#cb3-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Exponential functions of leaf area</span></span>
<span id="cb3-106"><a href="attachements.html#cb3-106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-107"><a href="attachements.html#cb3-107" aria-hidden="true" tabindex="-1"></a>  s1 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span>h <span class="sc">*</span> clump_OMEGA <span class="sc">*</span> x);</span>
<span id="cb3-108"><a href="attachements.html#cb3-108" aria-hidden="true" tabindex="-1"></a>  s2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">exp</span>(<span class="sc">-</span>Kb <span class="sc">*</span> clump_OMEGA <span class="sc">*</span> x)</span>
<span id="cb3-109"><a href="attachements.html#cb3-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-110"><a href="attachements.html#cb3-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- Diffuse solution</span></span>
<span id="cb3-111"><a href="attachements.html#cb3-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-112"><a href="attachements.html#cb3-112" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n1d and n2d (Eq. 14.99) and n2 (14.100)</span></span>
<span id="cb3-113"><a href="attachements.html#cb3-113" aria-hidden="true" tabindex="-1"></a>  num <span class="ot">&lt;-</span> sw_sky_d <span class="sc">*</span> (u <span class="sc">+</span> v <span class="sc">*</span> alb_soil_d) <span class="sc">*</span> <span class="fu">s1</span>(LAI)</span>
<span id="cb3-114"><a href="attachements.html#cb3-114" aria-hidden="true" tabindex="-1"></a>  den1 <span class="ot">&lt;-</span> v <span class="sc">*</span> (v <span class="sc">+</span> u <span class="sc">*</span> alb_soil_d) <span class="sc">/</span> <span class="fu">s1</span>(LAI)</span>
<span id="cb3-115"><a href="attachements.html#cb3-115" aria-hidden="true" tabindex="-1"></a>  den2 <span class="ot">&lt;-</span> u <span class="sc">*</span> (u <span class="sc">+</span> v <span class="sc">*</span> alb_soil_d) <span class="sc">*</span> <span class="fu">s1</span>(LAI)</span>
<span id="cb3-116"><a href="attachements.html#cb3-116" aria-hidden="true" tabindex="-1"></a>  n2d <span class="ot">&lt;-</span> num <span class="sc">/</span> (den1 <span class="sc">-</span> den2)</span>
<span id="cb3-117"><a href="attachements.html#cb3-117" aria-hidden="true" tabindex="-1"></a>  n1d <span class="ot">&lt;-</span> <span class="sc">-</span>(sw_sky_d <span class="sc">+</span> n2d <span class="sc">*</span> u) <span class="sc">/</span> v</span>
<span id="cb3-118"><a href="attachements.html#cb3-118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-119"><a href="attachements.html#cb3-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scattered diffuse fluxes:</span></span>
<span id="cb3-120"><a href="attachements.html#cb3-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># iupwd - diffuse flux scattered upward above cumulative LAI (W/m2); Eq. (14.101)</span></span>
<span id="cb3-121"><a href="attachements.html#cb3-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># idwnd - diffuse flux scattered downward below cumulative LAI (W/m2); Eq. (14.102)</span></span>
<span id="cb3-122"><a href="attachements.html#cb3-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-123"><a href="attachements.html#cb3-123" aria-hidden="true" tabindex="-1"></a>  i_upw_d <span class="ot">&lt;-</span> <span class="cf">function</span>(x)  n1d <span class="sc">*</span> u <span class="sc">*</span> <span class="fu">s1</span>(x) <span class="sc">+</span> n2d <span class="sc">*</span> v <span class="sc">/</span> <span class="fu">s1</span>(x)</span>
<span id="cb3-124"><a href="attachements.html#cb3-124" aria-hidden="true" tabindex="-1"></a>  i_dwn_d <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="sc">-</span>n1d <span class="sc">*</span> v <span class="sc">*</span> <span class="fu">s1</span>(x) <span class="sc">-</span> n2d <span class="sc">*</span> u <span class="sc">/</span> <span class="fu">s1</span>(x)</span>
<span id="cb3-125"><a href="attachements.html#cb3-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-126"><a href="attachements.html#cb3-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-127"><a href="attachements.html#cb3-127" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; icd - diffuse flux absorbed by canopy (W/m2); Eq. (14.104)</span></span>
<span id="cb3-128"><a href="attachements.html#cb3-128" aria-hidden="true" tabindex="-1"></a>  ic_d <span class="ot">&lt;-</span> sw_sky_d <span class="sc">-</span> <span class="fu">i_upw_d</span>(<span class="dv">0</span>) <span class="sc">+</span> <span class="fu">i_upw_d</span>(LAI) <span class="sc">-</span> <span class="fu">i_dwn_d</span>(LAI)</span>
<span id="cb3-129"><a href="attachements.html#cb3-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-130"><a href="attachements.html#cb3-130" aria-hidden="true" tabindex="-1"></a>  <span class="co">#&#39; ig_b - diffuse flux absorbed by the soil; Eq 14.105</span></span>
<span id="cb3-131"><a href="attachements.html#cb3-131" aria-hidden="true" tabindex="-1"></a>  ig_d <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> alb_soil_d) <span class="sc">*</span> <span class="fu">i_dwn_d</span>(LAI)</span>
<span id="cb3-132"><a href="attachements.html#cb3-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-133"><a href="attachements.html#cb3-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># icsund - diffuse flux absorbed by sunlit canopy (W/m2); Eq. (14.120)</span></span>
<span id="cb3-134"><a href="attachements.html#cb3-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># icshad - diffuse flux absorbed by shaded canopy (W/m2); Eq. (14.121)</span></span>
<span id="cb3-135"><a href="attachements.html#cb3-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-136"><a href="attachements.html#cb3-136" aria-hidden="true" tabindex="-1"></a>  a1d <span class="ot">&lt;-</span>  n1d <span class="sc">*</span> u <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">*</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">+</span> h) <span class="sc">+</span> n2d <span class="sc">*</span> v <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">/</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">-</span> h)</span>
<span id="cb3-137"><a href="attachements.html#cb3-137" aria-hidden="true" tabindex="-1"></a>  a2d <span class="ot">&lt;-</span> <span class="sc">-</span>n1d <span class="sc">*</span> v <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">*</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">+</span> h) <span class="sc">-</span> n2d <span class="sc">*</span> u <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">s2</span>(LAI)<span class="sc">/</span><span class="fu">s1</span>(LAI)) <span class="sc">/</span> (Kb <span class="sc">-</span> h)</span>
<span id="cb3-138"><a href="attachements.html#cb3-138" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-139"><a href="attachements.html#cb3-139" aria-hidden="true" tabindex="-1"></a>  ic_sun_d <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> omega_leaf) <span class="sc">*</span> Kd <span class="sc">*</span> (a1d <span class="sc">+</span> a2d) <span class="sc">*</span> clump_OMEGA</span>
<span id="cb3-140"><a href="attachements.html#cb3-140" aria-hidden="true" tabindex="-1"></a>  ic_sha_d <span class="ot">&lt;-</span> ic_d <span class="sc">-</span> ic_sun_d</span>
<span id="cb3-141"><a href="attachements.html#cb3-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-142"><a href="attachements.html#cb3-142" aria-hidden="true" tabindex="-1"></a>  i_up_d <span class="ot">&lt;-</span>  <span class="fu">i_upw_d</span>(<span class="dv">0</span>)</span>
<span id="cb3-143"><a href="attachements.html#cb3-143" aria-hidden="true" tabindex="-1"></a>  i_down_d <span class="ot">&lt;-</span>  <span class="fu">i_dwn_d</span>(LAI)</span>
<span id="cb3-144"><a href="attachements.html#cb3-144" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-145"><a href="attachements.html#cb3-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ic_d =</span> ic_d, <span class="at">ic_sun_d =</span> ic_sun_d, <span class="at">ic_sha_d =</span> ic_sha_d, <span class="at">ig_d =</span> ig_d , <span class="at">i_up_d =</span> i_up_d, <span class="at">i_down_d =</span> i_down_d))</span>
<span id="cb3-146"><a href="attachements.html#cb3-146" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-147"><a href="attachements.html#cb3-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-148"><a href="attachements.html#cb3-148" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the shortwave radiation absorbed by the canopy with sunlit and shaded components</span></span>
<span id="cb3-149"><a href="attachements.html#cb3-149" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb3-150"><a href="attachements.html#cb3-150" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sw_sky_b direct beam radiation above the canopy in W m-2</span></span>
<span id="cb3-151"><a href="attachements.html#cb3-151" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param sw_sky_d diffuse radiation above the canopy in W m-2</span></span>
<span id="cb3-152"><a href="attachements.html#cb3-152" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param LAI Leaf Area Index</span></span>
<span id="cb3-153"><a href="attachements.html#cb3-153" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kb Direct beam extiction coefficient</span></span>
<span id="cb3-154"><a href="attachements.html#cb3-154" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kd Diffuse exiction coefficient</span></span>
<span id="cb3-155"><a href="attachements.html#cb3-155" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta Fraction of diffuse radiation upward scattered</span></span>
<span id="cb3-156"><a href="attachements.html#cb3-156" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param beta0 Fraction of direct beam radiation upward scattered</span></span>
<span id="cb3-157"><a href="attachements.html#cb3-157" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param omega_leaf Leaf scattering coefficient (reflectace + trasmittance)</span></span>
<span id="cb3-158"><a href="attachements.html#cb3-158" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param clump_OMEGA Canopy clumping coefficient</span></span>
<span id="cb3-159"><a href="attachements.html#cb3-159" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param alb_soil_b Albedo soil for direct beam radiation</span></span>
<span id="cb3-160"><a href="attachements.html#cb3-160" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param alb_soil_d Albedo soil for diffuse radiation</span></span>
<span id="cb3-161"><a href="attachements.html#cb3-161" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb3-162"><a href="attachements.html#cb3-162" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return list of ic, ic_sun, ic_sha</span></span>
<span id="cb3-163"><a href="attachements.html#cb3-163" aria-hidden="true" tabindex="-1"></a>shortwave_radiation <span class="ot">&lt;-</span> <span class="cf">function</span>(sw_sky_b, sw_sky_d, LAI, Kb, Kd, beta, beta0, omega_leaf, clump_OMEGA, alb_soil_b, alb_soil_d){</span>
<span id="cb3-164"><a href="attachements.html#cb3-164" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb3-165"><a href="attachements.html#cb3-165" aria-hidden="true" tabindex="-1"></a>  ib <span class="ot">&lt;-</span> <span class="fu">direct_beam_radiation</span>(sw_sky_b, LAI, Kb, Kd, beta, beta0, omega_leaf, clump_OMEGA, alb_soil_b, alb_soil_d)</span>
<span id="cb3-166"><a href="attachements.html#cb3-166" aria-hidden="true" tabindex="-1"></a>  id <span class="ot">&lt;-</span> <span class="fu">diffuse_radiation</span>(sw_sky_d, LAI, Kb, Kd, beta, beta0, omega_leaf, clump_OMEGA, alb_soil_d)</span>
<span id="cb3-167"><a href="attachements.html#cb3-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-168"><a href="attachements.html#cb3-168" aria-hidden="true" tabindex="-1"></a>  ic <span class="ot">&lt;-</span> ib<span class="sc">$</span>ic_b <span class="sc">+</span> id<span class="sc">$</span>ic_d</span>
<span id="cb3-169"><a href="attachements.html#cb3-169" aria-hidden="true" tabindex="-1"></a>  ic_sun <span class="ot">&lt;-</span> ib<span class="sc">$</span>ic_sun_b <span class="sc">+</span> id<span class="sc">$</span>ic_sun_d</span>
<span id="cb3-170"><a href="attachements.html#cb3-170" aria-hidden="true" tabindex="-1"></a>  ic_sha <span class="ot">&lt;-</span> ib<span class="sc">$</span>ic_sha_b <span class="sc">+</span> id<span class="sc">$</span>ic_sha_d</span>
<span id="cb3-171"><a href="attachements.html#cb3-171" aria-hidden="true" tabindex="-1"></a>  ig <span class="ot">&lt;-</span> ib<span class="sc">$</span>ig_b <span class="sc">+</span> id<span class="sc">$</span>ig_d</span>
<span id="cb3-172"><a href="attachements.html#cb3-172" aria-hidden="true" tabindex="-1"></a>  i_up <span class="ot">&lt;-</span> ib<span class="sc">$</span>i_up_b <span class="sc">+</span> id<span class="sc">$</span>i_up_d</span>
<span id="cb3-173"><a href="attachements.html#cb3-173" aria-hidden="true" tabindex="-1"></a>  i_down <span class="ot">&lt;-</span> ib<span class="sc">$</span>i_down_b <span class="sc">+</span> id<span class="sc">$</span>i_down_d</span>
<span id="cb3-174"><a href="attachements.html#cb3-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-175"><a href="attachements.html#cb3-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ic =</span> ic, <span class="at">ic_sun =</span> ic_sun, <span class="at">ic_sha =</span> ic_sha, <span class="at">ig=</span>ig, <span class="at">i_up =</span> i_up, <span class="at">i_down =</span> i_down))</span>
<span id="cb3-176"><a href="attachements.html#cb3-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-177"><a href="attachements.html#cb3-177" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="longwave-4" class="section level3" number="6.1.4">
<h3><span class="header-section-number">6.1.4</span> Longwave</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="attachements.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">## simplified longwave model (assumes there is no upward scattering)</span></span>
<span id="cb4-2"><a href="attachements.html#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="attachements.html#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Calculate the longwave radiation absorbed by the canopy with sunlit and shaded components</span></span>
<span id="cb4-4"><a href="attachements.html#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param lw_sky_d longwave radiation above the canopy in W m-2</span></span>
<span id="cb4-5"><a href="attachements.html#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param t_leaf temperature leaves (in Kelvin)</span></span>
<span id="cb4-6"><a href="attachements.html#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param t_soil temperature of soil (in Kelvin)</span></span>
<span id="cb4-7"><a href="attachements.html#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param LAI Leaf Area Index</span></span>
<span id="cb4-8"><a href="attachements.html#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kb Direct beam extiction coefficient</span></span>
<span id="cb4-9"><a href="attachements.html#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param Kd Diffuse exiction coefficient</span></span>
<span id="cb4-10"><a href="attachements.html#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param em_leaf Longwave emissivity of leaf</span></span>
<span id="cb4-11"><a href="attachements.html#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param em_soil Longwave emissivity of soil</span></span>
<span id="cb4-12"><a href="attachements.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb4-13"><a href="attachements.html#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @return list of lc, lg, lc_sun, lc_sha, l_up, l_down</span></span>
<span id="cb4-14"><a href="attachements.html#cb4-14" aria-hidden="true" tabindex="-1"></a>longwave_radiation <span class="ot">&lt;-</span> <span class="cf">function</span>(lw_sky, LAI, t_leaf, t_soil, Kb, Kd, em_leaf, em_soil){</span>
<span id="cb4-15"><a href="attachements.html#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="do">## commonly used terms--</span></span>
<span id="cb4-16"><a href="attachements.html#cb4-16" aria-hidden="true" tabindex="-1"></a>  sigma <span class="ot">&lt;-</span> <span class="fl">5.67e-08</span>   <span class="co"># Stefan-Boltzmann constant W m-2 K-4</span></span>
<span id="cb4-17"><a href="attachements.html#cb4-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-18"><a href="attachements.html#cb4-18" aria-hidden="true" tabindex="-1"></a>  lw_soil_emit <span class="ot">&lt;-</span> em_soil <span class="sc">*</span> sigma <span class="sc">*</span> t_soil<span class="sc">^</span><span class="dv">4</span></span>
<span id="cb4-19"><a href="attachements.html#cb4-19" aria-hidden="true" tabindex="-1"></a>  lw_leaf_emit <span class="ot">&lt;-</span> em_leaf <span class="sc">*</span> sigma  <span class="sc">*</span> t_leaf<span class="sc">^</span><span class="dv">4</span></span>
<span id="cb4-20"><a href="attachements.html#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="attachements.html#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Equation 14.134</span></span>
<span id="cb4-22"><a href="attachements.html#cb4-22" aria-hidden="true" tabindex="-1"></a>  lw_down_trans <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb4-23"><a href="attachements.html#cb4-23" aria-hidden="true" tabindex="-1"></a>    lw_sky <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> em_leaf <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Kd <span class="sc">*</span> x)))</span>
<span id="cb4-24"><a href="attachements.html#cb4-24" aria-hidden="true" tabindex="-1"></a>  lw_down_emit <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb4-25"><a href="attachements.html#cb4-25" aria-hidden="true" tabindex="-1"></a>    lw_leaf_emit <span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Kd <span class="sc">*</span> x))</span>
<span id="cb4-26"><a href="attachements.html#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="attachements.html#cb4-27" aria-hidden="true" tabindex="-1"></a>  lw_down <span class="ot">&lt;-</span> <span class="cf">function</span>(LAI) <span class="fu">lw_down_emit</span>(LAI) <span class="sc">+</span> <span class="fu">lw_down_trans</span>(LAI)</span>
<span id="cb4-28"><a href="attachements.html#cb4-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-29"><a href="attachements.html#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="attachements.html#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Equation 14.135</span></span>
<span id="cb4-31"><a href="attachements.html#cb4-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-32"><a href="attachements.html#cb4-32" aria-hidden="true" tabindex="-1"></a>  lw_up_trans <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-33"><a href="attachements.html#cb4-33" aria-hidden="true" tabindex="-1"></a>    lw_soil_emit <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> em_leaf <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Kd <span class="sc">*</span> (LAI <span class="sc">-</span> x))))</span>
<span id="cb4-34"><a href="attachements.html#cb4-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-35"><a href="attachements.html#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="attachements.html#cb4-36" aria-hidden="true" tabindex="-1"></a>  lw_up_emit <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb4-37"><a href="attachements.html#cb4-37" aria-hidden="true" tabindex="-1"></a>    lw_leaf_emit <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Kd <span class="sc">*</span> (LAI <span class="sc">-</span> x)))</span>
<span id="cb4-38"><a href="attachements.html#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="attachements.html#cb4-39" aria-hidden="true" tabindex="-1"></a>  lw_up <span class="ot">&lt;-</span> <span class="cf">function</span> (x) <span class="fu">lw_up_trans</span>(x) <span class="sc">+</span> <span class="fu">lw_up_emit</span>(x)</span>
<span id="cb4-40"><a href="attachements.html#cb4-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Equation 14.137</span></span>
<span id="cb4-41"><a href="attachements.html#cb4-41" aria-hidden="true" tabindex="-1"></a>  perc_abs <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">-</span><span class="fu">exp</span>(<span class="sc">-</span>Kd <span class="sc">*</span> LAI) <span class="co"># amount absorbed</span></span>
<span id="cb4-42"><a href="attachements.html#cb4-42" aria-hidden="true" tabindex="-1"></a>  lc <span class="ot">&lt;-</span> perc_abs <span class="sc">*</span> (em_leaf <span class="sc">*</span> (lw_sky <span class="sc">+</span> lw_soil_emit)</span>
<span id="cb4-43"><a href="attachements.html#cb4-43" aria-hidden="true" tabindex="-1"></a>         <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> lw_leaf_emit)</span>
<span id="cb4-44"><a href="attachements.html#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="attachements.html#cb4-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Equation 14.138</span></span>
<span id="cb4-46"><a href="attachements.html#cb4-46" aria-hidden="true" tabindex="-1"></a>  lg<span class="ot">&lt;-</span> <span class="fu">lw_down</span>(LAI) <span class="sc">-</span> lw_soil_emit <span class="co"># Lw adboserbed by the soil</span></span>
<span id="cb4-47"><a href="attachements.html#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="attachements.html#cb4-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-49"><a href="attachements.html#cb4-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">### --- Sunlit and shaded leaves ---</span></span>
<span id="cb4-50"><a href="attachements.html#cb4-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-51"><a href="attachements.html#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sunlit Eq. 14.140</span></span>
<span id="cb4-52"><a href="attachements.html#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="attachements.html#cb4-53" aria-hidden="true" tabindex="-1"></a>  lc_sun <span class="ot">&lt;-</span></span>
<span id="cb4-54"><a href="attachements.html#cb4-54" aria-hidden="true" tabindex="-1"></a>  (</span>
<span id="cb4-55"><a href="attachements.html#cb4-55" aria-hidden="true" tabindex="-1"></a>      (</span>
<span id="cb4-56"><a href="attachements.html#cb4-56" aria-hidden="true" tabindex="-1"></a>        (em_leaf <span class="sc">*</span> (lw_sky <span class="sc">-</span> sigma <span class="sc">*</span> t_leaf <span class="sc">^</span> <span class="dv">4</span> ) <span class="sc">*</span> Kd )</span>
<span id="cb4-57"><a href="attachements.html#cb4-57" aria-hidden="true" tabindex="-1"></a>        <span class="sc">/</span> (Kd <span class="sc">+</span> Kb)</span>
<span id="cb4-58"><a href="attachements.html#cb4-58" aria-hidden="true" tabindex="-1"></a>        <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>(Kd <span class="sc">+</span> Kb) <span class="sc">*</span> LAI))</span>
<span id="cb4-59"><a href="attachements.html#cb4-59" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-60"><a href="attachements.html#cb4-60" aria-hidden="true" tabindex="-1"></a>      <span class="sc">+</span></span>
<span id="cb4-61"><a href="attachements.html#cb4-61" aria-hidden="true" tabindex="-1"></a>      (</span>
<span id="cb4-62"><a href="attachements.html#cb4-62" aria-hidden="true" tabindex="-1"></a>        (em_leaf <span class="sc">*</span>(lw_soil_emit <span class="sc">-</span> sigma <span class="sc">*</span> t_leaf <span class="sc">^</span> <span class="dv">4</span> ) <span class="sc">*</span> Kd)</span>
<span id="cb4-63"><a href="attachements.html#cb4-63" aria-hidden="true" tabindex="-1"></a>        <span class="sc">/</span> (Kd <span class="sc">-</span> Kb)</span>
<span id="cb4-64"><a href="attachements.html#cb4-64" aria-hidden="true" tabindex="-1"></a>        <span class="sc">*</span> (<span class="fu">exp</span>(<span class="sc">-</span>Kb <span class="sc">*</span> LAI)  <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span>Kd <span class="sc">*</span> LAI))</span>
<span id="cb4-65"><a href="attachements.html#cb4-65" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb4-66"><a href="attachements.html#cb4-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-67"><a href="attachements.html#cb4-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-68"><a href="attachements.html#cb4-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Shaded Eq. 14.141</span></span>
<span id="cb4-69"><a href="attachements.html#cb4-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-70"><a href="attachements.html#cb4-70" aria-hidden="true" tabindex="-1"></a>  lc_sha <span class="ot">&lt;-</span> lc <span class="sc">-</span> lc_sun</span>
<span id="cb4-71"><a href="attachements.html#cb4-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-72"><a href="attachements.html#cb4-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">lc =</span> lc,                        <span class="co"># Lw radiation absorbed by the canopy</span></span>
<span id="cb4-73"><a href="attachements.html#cb4-73" aria-hidden="true" tabindex="-1"></a>              <span class="at">lg =</span> lg,                        <span class="co"># Lw radiation absorbed by the soil</span></span>
<span id="cb4-74"><a href="attachements.html#cb4-74" aria-hidden="true" tabindex="-1"></a>              <span class="at">lc_sun =</span> lc_sun,                <span class="co"># Lw radiation absorbed by the sunlit canopy</span></span>
<span id="cb4-75"><a href="attachements.html#cb4-75" aria-hidden="true" tabindex="-1"></a>              <span class="at">lc_sha =</span> lc_sha,                <span class="co"># Lw radiation absorbed by the shaded canopy</span></span>
<span id="cb4-76"><a href="attachements.html#cb4-76" aria-hidden="true" tabindex="-1"></a>              <span class="at">l_up =</span> <span class="fu">lw_up</span>(<span class="dv">0</span>),             <span class="co"># Lw emitted into the sky</span></span>
<span id="cb4-77"><a href="attachements.html#cb4-77" aria-hidden="true" tabindex="-1"></a>              <span class="at">l_down =</span> <span class="fu">lw_down</span>(LAI)           <span class="co"># Lw reaching the soil</span></span>
<span id="cb4-78"><a href="attachements.html#cb4-78" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb4-79"><a href="attachements.html#cb4-79" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="report-code" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Report code</h2>
<p>This is the code used for writing this report</p>
<div id="setup" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Setup</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="attachements.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># setup input and fluxes for 2016 (because in 2018 lw is NA)</span></span>
<span id="cb5-2"><a href="attachements.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-3"><a href="attachements.html#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(progress)</span>
<span id="cb5-4"><a href="attachements.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)</span>
<span id="cb5-5"><a href="attachements.html#cb5-5" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="dv">3600</span></span>
<span id="cb5-6"><a href="attachements.html#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;setup_parameters.R&quot;</span>)</span>
<span id="cb5-7"><a href="attachements.html#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="attachements.html#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;fun_calc_radiative_transfer.R&quot;</span>)</span>
<span id="cb5-9"><a href="attachements.html#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="attachements.html#cb5-10" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;Hainich_2018_input.csv&#39;</span>))</span>
<span id="cb5-11"><a href="attachements.html#cb5-11" aria-hidden="true" tabindex="-1"></a>fluxes <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;Hainich_2018_fluxes.csv&#39;</span>))</span>
<span id="cb5-12"><a href="attachements.html#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="attachements.html#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial variable selection, renaming and conversion</span></span>
<span id="cb5-14"><a href="attachements.html#cb5-14" aria-hidden="true" tabindex="-1"></a>input <span class="ot">&lt;-</span> input <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb5-15"><a href="attachements.html#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(input),</span>
<span id="cb5-16"><a href="attachements.html#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">force_tz</span>(<span class="fu">as_datetime</span>(Date.Time), <span class="st">&quot;Etc/GMT+1&quot;</span>),</span>
<span id="cb5-17"><a href="attachements.html#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">tair =</span> TA_F <span class="sc">+</span> <span class="fl">273.15</span>,  <span class="co"># Celsius to Kelvin</span></span>
<span id="cb5-18"><a href="attachements.html#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> P_F<span class="sc">/</span><span class="dv">1000</span>,          <span class="co"># mm time_step-1 to m3 m-2 time_step-1</span></span>
<span id="cb5-19"><a href="attachements.html#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_in =</span> SW_IN_F,       <span class="co"># W m-2</span></span>
<span id="cb5-20"><a href="attachements.html#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">lw_in =</span> LW_IN_F,       <span class="co"># W m-2</span></span>
<span id="cb5-21"><a href="attachements.html#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">ppfd_in =</span> PPFD_IN,     <span class="co"># µmol m-2 s-1</span></span>
<span id="cb5-22"><a href="attachements.html#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">vpd =</span> VPD_F <span class="sc">*</span> <span class="dv">100</span>,     <span class="co"># hPa to Pa</span></span>
<span id="cb5-23"><a href="attachements.html#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">pa =</span> PA_F <span class="sc">*</span> <span class="dv">1000</span>,      <span class="co"># kPa to Pa</span></span>
<span id="cb5-24"><a href="attachements.html#cb5-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">ws =</span> WS_F,             <span class="co"># m s-1</span></span>
<span id="cb5-25"><a href="attachements.html#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">rh =</span> RH <span class="sc">/</span> <span class="dv">100</span>,         <span class="co"># percent to fraction</span></span>
<span id="cb5-26"><a href="attachements.html#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_dif =</span> SW_DIF,       <span class="co"># W m-2</span></span>
<span id="cb5-27"><a href="attachements.html#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">co2 =</span> CO2_F_MDS,       <span class="co"># µmol mol-1</span></span>
<span id="cb5-28"><a href="attachements.html#cb5-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">night =</span> <span class="fu">as_factor</span>(<span class="fu">as.integer</span>(NIGHT)),</span>
<span id="cb5-29"><a href="attachements.html#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span></span>
<span id="cb5-30"><a href="attachements.html#cb5-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-31"><a href="attachements.html#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="attachements.html#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="attachements.html#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial variable selection, renaming and conversion</span></span>
<span id="cb5-34"><a href="attachements.html#cb5-34" aria-hidden="true" tabindex="-1"></a><span class="co"># tsoil and swc means across soil depths don&#39;t take into account layer thickness or properties.</span></span>
<span id="cb5-35"><a href="attachements.html#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># We ignore this for the purpose of this excersice.</span></span>
<span id="cb5-36"><a href="attachements.html#cb5-36" aria-hidden="true" tabindex="-1"></a>fluxes <span class="ot">&lt;-</span> fluxes <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb5-37"><a href="attachements.html#cb5-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(fluxes),</span>
<span id="cb5-38"><a href="attachements.html#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_out =</span> SW_OUT,          <span class="co"># W m-2</span></span>
<span id="cb5-39"><a href="attachements.html#cb5-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">tsoil =</span> ((TS_F_MDS_1 <span class="sc">+</span> TS_F_MDS_2 <span class="sc">+</span> TS_F_MDS_3 <span class="sc">+</span> TS_F_MDS_4 <span class="sc">+</span> TS_F_MDS_5) <span class="sc">/</span> <span class="dv">5</span>) <span class="sc">+</span> <span class="fl">273.15</span>, <span class="co"># 30cm depth mean. Celsius to Kelvin</span></span>
<span id="cb5-40"><a href="attachements.html#cb5-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">swc =</span> ((SWC_F_MDS_1 <span class="sc">+</span> SWC_F_MDS_2 <span class="sc">+</span> SWC_F_MDS_3) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">/</span> <span class="dv">100</span>, <span class="co"># 30cm depth mean. Percent to fraction</span></span>
<span id="cb5-41"><a href="attachements.html#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">g =</span> G_F_MDS,              <span class="co"># W m-2</span></span>
<span id="cb5-42"><a href="attachements.html#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">le =</span> LE_F_MDS,            <span class="co"># W m-2</span></span>
<span id="cb5-43"><a href="attachements.html#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> H_F_MDS,              <span class="co"># W m-2</span></span>
<span id="cb5-44"><a href="attachements.html#cb5-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">nee =</span> NEE_VUT_REF <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> dt,        <span class="co"># µmol m-2 s-1 to kg m-2 dt-1</span></span>
<span id="cb5-45"><a href="attachements.html#cb5-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">reco =</span> RECO_NT_VUT_REF <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> dt,   <span class="co"># µmol m-2 s-1 to kg m-2 dt-1</span></span>
<span id="cb5-46"><a href="attachements.html#cb5-46" aria-hidden="true" tabindex="-1"></a>  <span class="at">gpp =</span> GPP_NT_VUT_REF <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> dt,     <span class="co"># µmol m-2 s-1 to kg m-2 dt-1</span></span>
<span id="cb5-47"><a href="attachements.html#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">TIMESTAMP_START =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-48"><a href="attachements.html#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="at">TIMESTAMP_END =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-49"><a href="attachements.html#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="at">NIGHT =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-50"><a href="attachements.html#cb5-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">lw_out =</span> LW_OUT,</span>
<span id="cb5-51"><a href="attachements.html#cb5-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">TS_F_MDS_5 =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-52"><a href="attachements.html#cb5-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">LE_RANDUNC =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-53"><a href="attachements.html#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">H_RANDUNC =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-54"><a href="attachements.html#cb5-54" aria-hidden="true" tabindex="-1"></a>  <span class="at">NEE_VUT_REF_JOINTUNC =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-55"><a href="attachements.html#cb5-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span></span>
<span id="cb5-56"><a href="attachements.html#cb5-56" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-57"><a href="attachements.html#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="attachements.html#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="attachements.html#cb5-59" aria-hidden="true" tabindex="-1"></a>state <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">t_leaf =</span> input<span class="sc">$</span>tair, <span class="at">t_soil =</span> fluxes<span class="sc">$</span>tsoil)</span>
<span id="cb5-60"><a href="attachements.html#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="attachements.html#cb5-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Data for 1 month used for calibration and sensitivity</span></span>
<span id="cb5-62"><a href="attachements.html#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="attachements.html#cb5-63" aria-hidden="true" tabindex="-1"></a>input_1m <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;Hainich_2018-07_input.csv&quot;</span>))</span>
<span id="cb5-64"><a href="attachements.html#cb5-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-65"><a href="attachements.html#cb5-65" aria-hidden="true" tabindex="-1"></a>fluxes_1m <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;Hainich_2018-07_fluxes.csv&quot;</span>))</span>
<span id="cb5-66"><a href="attachements.html#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="attachements.html#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial variable selection, renaming and conversion</span></span>
<span id="cb5-68"><a href="attachements.html#cb5-68" aria-hidden="true" tabindex="-1"></a>input_1m <span class="ot">&lt;-</span> input_1m <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb5-69"><a href="attachements.html#cb5-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(input_1m),</span>
<span id="cb5-70"><a href="attachements.html#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">force_tz</span>(<span class="fu">as_datetime</span>(Date.Time), <span class="st">&quot;Etc/GMT+1&quot;</span>),</span>
<span id="cb5-71"><a href="attachements.html#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">tair =</span> TA_F <span class="sc">+</span> <span class="fl">273.15</span>,  <span class="co"># Celsius to Kelvin</span></span>
<span id="cb5-72"><a href="attachements.html#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">p =</span> P_F,               <span class="co"># mm / time_step = l m-2 / time_step</span></span>
<span id="cb5-73"><a href="attachements.html#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_in =</span> SW_IN_F,       <span class="co"># W m-2</span></span>
<span id="cb5-74"><a href="attachements.html#cb5-74" aria-hidden="true" tabindex="-1"></a>  <span class="at">lw_in =</span> LW_IN_F,       <span class="co"># W m-2</span></span>
<span id="cb5-75"><a href="attachements.html#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="at">ppfd_in =</span> PPFD_IN,     <span class="co"># µmol m-2 s-1</span></span>
<span id="cb5-76"><a href="attachements.html#cb5-76" aria-hidden="true" tabindex="-1"></a>  <span class="at">vpd =</span> VPD_F <span class="sc">*</span> <span class="dv">100</span>,     <span class="co"># hPa to Pa</span></span>
<span id="cb5-77"><a href="attachements.html#cb5-77" aria-hidden="true" tabindex="-1"></a>  <span class="at">pa =</span> PA_F <span class="sc">*</span> <span class="dv">1000</span>,      <span class="co"># kPa to Pa</span></span>
<span id="cb5-78"><a href="attachements.html#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="at">ws =</span> WS_F,             <span class="co"># m s-1</span></span>
<span id="cb5-79"><a href="attachements.html#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="at">rh =</span> RH <span class="sc">/</span> <span class="dv">100</span>,         <span class="co"># percent to fraction</span></span>
<span id="cb5-80"><a href="attachements.html#cb5-80" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_dif =</span> SW_DIF,       <span class="co"># W m-2</span></span>
<span id="cb5-81"><a href="attachements.html#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="at">co2 =</span> CO2_F_MDS,       <span class="co"># µmol mol-1</span></span>
<span id="cb5-82"><a href="attachements.html#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="at">NIGHT =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-83"><a href="attachements.html#cb5-83" aria-hidden="true" tabindex="-1"></a>  <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span></span>
<span id="cb5-84"><a href="attachements.html#cb5-84" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-85"><a href="attachements.html#cb5-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-86"><a href="attachements.html#cb5-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-87"><a href="attachements.html#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial variable selection, renaming and conversion</span></span>
<span id="cb5-88"><a href="attachements.html#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="co"># tsoil and swc means across soil depths don&#39;t take into account layer thickness or properties.</span></span>
<span id="cb5-89"><a href="attachements.html#cb5-89" aria-hidden="true" tabindex="-1"></a><span class="co"># We ignore this for the purpose of this excersice.</span></span>
<span id="cb5-90"><a href="attachements.html#cb5-90" aria-hidden="true" tabindex="-1"></a>fluxes_1m <span class="ot">&lt;-</span> fluxes_1m <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb5-91"><a href="attachements.html#cb5-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(fluxes_1m),</span>
<span id="cb5-92"><a href="attachements.html#cb5-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_out =</span> SW_OUT,          <span class="co"># W m-2</span></span>
<span id="cb5-93"><a href="attachements.html#cb5-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">lw_out =</span> LW_OUT,          <span class="co"># W m-2</span></span>
<span id="cb5-94"><a href="attachements.html#cb5-94" aria-hidden="true" tabindex="-1"></a>  <span class="at">tsoil =</span> ((TS_F_MDS_1 <span class="sc">+</span> TS_F_MDS_2 <span class="sc">+</span> TS_F_MDS_3 <span class="sc">+</span> TS_F_MDS_4) <span class="sc">/</span> <span class="dv">4</span>) <span class="sc">+</span> <span class="fl">273.15</span>, <span class="co"># 30cm depth mean. Celsius to Kelvin</span></span>
<span id="cb5-95"><a href="attachements.html#cb5-95" aria-hidden="true" tabindex="-1"></a>  <span class="at">swc =</span> ((SWC_F_MDS_1 <span class="sc">+</span> SWC_F_MDS_2 <span class="sc">+</span> SWC_F_MDS_3) <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">/</span> <span class="dv">100</span>, <span class="co"># 30cm depth mean. Percent to fraction</span></span>
<span id="cb5-96"><a href="attachements.html#cb5-96" aria-hidden="true" tabindex="-1"></a>  <span class="at">g =</span> G_F_MDS,              <span class="co"># W m-2</span></span>
<span id="cb5-97"><a href="attachements.html#cb5-97" aria-hidden="true" tabindex="-1"></a>  <span class="at">le =</span> LE_F_MDS,            <span class="co"># W m-2</span></span>
<span id="cb5-98"><a href="attachements.html#cb5-98" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> H_F_MDS,              <span class="co"># W m-2</span></span>
<span id="cb5-99"><a href="attachements.html#cb5-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">nee =</span> NEE_VUT_REF <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> dt,        <span class="co"># µmol m-2 s-1 to kg m-2 dt-1</span></span>
<span id="cb5-100"><a href="attachements.html#cb5-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">reco =</span> RECO_NT_VUT_REF <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> dt,   <span class="co"># µmol m-2 s-1 to kg m-2 dt-1</span></span>
<span id="cb5-101"><a href="attachements.html#cb5-101" aria-hidden="true" tabindex="-1"></a>  <span class="at">gpp =</span> GPP_NT_VUT_REF <span class="sc">*</span> <span class="dv">12</span> <span class="sc">/</span> <span class="dv">1000000</span> <span class="sc">/</span> <span class="dv">1000</span> <span class="sc">*</span> dt,     <span class="co"># µmol m-2 s-1 to kg m-2 dt-1</span></span>
<span id="cb5-102"><a href="attachements.html#cb5-102" aria-hidden="true" tabindex="-1"></a>  <span class="at">TIMESTAMP_START =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-103"><a href="attachements.html#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="at">TIMESTAMP_END =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-104"><a href="attachements.html#cb5-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">NIGHT =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-105"><a href="attachements.html#cb5-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">TS_F_MDS_5 =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-106"><a href="attachements.html#cb5-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">LE_RANDUNC =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-107"><a href="attachements.html#cb5-107" aria-hidden="true" tabindex="-1"></a>  <span class="at">H_RANDUNC =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-108"><a href="attachements.html#cb5-108" aria-hidden="true" tabindex="-1"></a>  <span class="at">NEE_VUT_REF_JOINTUNC =</span> <span class="cn">NULL</span>,</span>
<span id="cb5-109"><a href="attachements.html#cb5-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">.keep =</span> <span class="st">&quot;unused&quot;</span></span>
<span id="cb5-110"><a href="attachements.html#cb5-110" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb5-111"><a href="attachements.html#cb5-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-112"><a href="attachements.html#cb5-112" aria-hidden="true" tabindex="-1"></a>state_1m <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">t_leaf =</span> input_1m<span class="sc">$</span>tair, <span class="at">t_soil =</span> fluxes_1m<span class="sc">$</span>tsoil)</span>
<span id="cb5-113"><a href="attachements.html#cb5-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-114"><a href="attachements.html#cb5-114" aria-hidden="true" tabindex="-1"></a><span class="co"># Utility funcs</span></span>
<span id="cb5-115"><a href="attachements.html#cb5-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-116"><a href="attachements.html#cb5-116" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Full radiative transfer model with potentially new paramameters that overwrite the defaults</span></span>
<span id="cb5-117"><a href="attachements.html#cb5-117" aria-hidden="true" tabindex="-1"></a>rad_transf_new_p <span class="ot">&lt;-</span> <span class="cf">function</span> (<span class="at">new_p=</span><span class="fu">list</span>()){</span>
<span id="cb5-118"><a href="attachements.html#cb5-118" aria-hidden="true" tabindex="-1"></a>  pars <span class="ot">&lt;-</span> <span class="fu">merge_lists</span>(pars, new_p)</span>
<span id="cb5-119"><a href="attachements.html#cb5-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rad_transf</span>(<span class="at">pars =</span> pars)</span>
<span id="cb5-120"><a href="attachements.html#cb5-120" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-121"><a href="attachements.html#cb5-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-122"><a href="attachements.html#cb5-122" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Full radiative transfer model with potentially new paramameters that overwrite the defaults. Using 1 month data</span></span>
<span id="cb5-123"><a href="attachements.html#cb5-123" aria-hidden="true" tabindex="-1"></a>rad_transf_new_p_1m <span class="ot">&lt;-</span> <span class="cf">function</span> (<span class="at">new_p=</span><span class="fu">list</span>()){</span>
<span id="cb5-124"><a href="attachements.html#cb5-124" aria-hidden="true" tabindex="-1"></a>  pars <span class="ot">&lt;-</span> <span class="fu">merge_lists</span>(pars, new_p)</span>
<span id="cb5-125"><a href="attachements.html#cb5-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rad_transf</span>(<span class="at">pars =</span> pars, <span class="at">input=</span> input_1m, <span class="at">state=</span>state_1m)</span>
<span id="cb5-126"><a href="attachements.html#cb5-126" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-127"><a href="attachements.html#cb5-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-128"><a href="attachements.html#cb5-128" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Full radiative transfer model</span></span>
<span id="cb5-129"><a href="attachements.html#cb5-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-130"><a href="attachements.html#cb5-130" aria-hidden="true" tabindex="-1"></a>d_input <span class="ot">&lt;-</span> input</span>
<span id="cb5-131"><a href="attachements.html#cb5-131" aria-hidden="true" tabindex="-1"></a>d_state <span class="ot">&lt;-</span> state</span>
<span id="cb5-132"><a href="attachements.html#cb5-132" aria-hidden="true" tabindex="-1"></a>d_pars <span class="ot">&lt;-</span>  pars</span>
<span id="cb5-133"><a href="attachements.html#cb5-133" aria-hidden="true" tabindex="-1"></a>d_dt <span class="ot">&lt;-</span> dt</span>
<span id="cb5-134"><a href="attachements.html#cb5-134" aria-hidden="true" tabindex="-1"></a>rad_transf <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">input =</span> d_input, <span class="at">state =</span> d_state, <span class="at">pars =</span> d_pars, <span class="at">dt =</span> d_dt){</span>
<span id="cb5-135"><a href="attachements.html#cb5-135" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb5-136"><a href="attachements.html#cb5-136" aria-hidden="true" tabindex="-1"></a>  pb <span class="ot">&lt;-</span> <span class="fu">setup_pb</span>()</span>
<span id="cb5-137"><a href="attachements.html#cb5-137" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(input<span class="sc">$</span>datetime)){</span>
<span id="cb5-138"><a href="attachements.html#cb5-138" aria-hidden="true" tabindex="-1"></a>    rad<span class="ot">&lt;-</span> <span class="fu">radiative_transfer_step_debug</span>(input[i,], state[i,], pars, dt)</span>
<span id="cb5-139"><a href="attachements.html#cb5-139" aria-hidden="true" tabindex="-1"></a>    out[i, <span class="fu">names</span>(rad)] <span class="ot">&lt;-</span> rad</span>
<span id="cb5-140"><a href="attachements.html#cb5-140" aria-hidden="true" tabindex="-1"></a>    pb<span class="sc">$</span><span class="fu">tick</span>()</span>
<span id="cb5-141"><a href="attachements.html#cb5-141" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-142"><a href="attachements.html#cb5-142" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb5-143"><a href="attachements.html#cb5-143" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-144"><a href="attachements.html#cb5-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-145"><a href="attachements.html#cb5-145" aria-hidden="true" tabindex="-1"></a>setup_pb <span class="ot">&lt;-</span> <span class="cf">function</span>(){</span>
<span id="cb5-146"><a href="attachements.html#cb5-146" aria-hidden="true" tabindex="-1"></a>  progress_bar<span class="sc">$</span><span class="fu">new</span>(<span class="at">format =</span> <span class="st">&quot;(:spin) [:bar] :percent [Elapsed: :elapsedfull | ETA: :eta]&quot;</span>,</span>
<span id="cb5-147"><a href="attachements.html#cb5-147" aria-hidden="true" tabindex="-1"></a>                       <span class="at">total =</span> <span class="fu">length</span>(input<span class="sc">$</span>datetime),</span>
<span id="cb5-148"><a href="attachements.html#cb5-148" aria-hidden="true" tabindex="-1"></a>                       <span class="at">clear =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-149"><a href="attachements.html#cb5-149" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-150"><a href="attachements.html#cb5-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-151"><a href="attachements.html#cb5-151" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; merges two list, in case of conflicts uses the second list value</span></span>
<span id="cb5-152"><a href="attachements.html#cb5-152" aria-hidden="true" tabindex="-1"></a>merge_lists <span class="ot">&lt;-</span> <span class="cf">function</span> (list1, list2){</span>
<span id="cb5-153"><a href="attachements.html#cb5-153" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> list1</span>
<span id="cb5-154"><a href="attachements.html#cb5-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (name <span class="cf">in</span> <span class="fu">names</span>(list2)){</span>
<span id="cb5-155"><a href="attachements.html#cb5-155" aria-hidden="true" tabindex="-1"></a>    l[name] <span class="ot">&lt;-</span> list2[name]</span>
<span id="cb5-156"><a href="attachements.html#cb5-156" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-157"><a href="attachements.html#cb5-157" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(l)</span>
<span id="cb5-158"><a href="attachements.html#cb5-158" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-159"><a href="attachements.html#cb5-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-160"><a href="attachements.html#cb5-160" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; transpose an aggreagated sensisivity dataframe</span></span>
<span id="cb5-161"><a href="attachements.html#cb5-161" aria-hidden="true" tabindex="-1"></a>invert_sens <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb5-162"><a href="attachements.html#cb5-162" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> df<span class="sc">$</span>var</span>
<span id="cb5-163"><a href="attachements.html#cb5-163" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">select</span>(df, <span class="sc">-</span>var)</span>
<span id="cb5-164"><a href="attachements.html#cb5-164" aria-hidden="true" tabindex="-1"></a>    pars <span class="ot">&lt;-</span> <span class="fu">names</span>(df)</span>
<span id="cb5-165"><a href="attachements.html#cb5-165" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(<span class="fu">t</span>(df))</span>
<span id="cb5-166"><a href="attachements.html#cb5-166" aria-hidden="true" tabindex="-1"></a>    df <span class="ot">&lt;-</span> <span class="fu">cbind</span>(pars, df)</span>
<span id="cb5-167"><a href="attachements.html#cb5-167" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(df) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, vars)</span>
<span id="cb5-168"><a href="attachements.html#cb5-168" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(df)</span>
<span id="cb5-169"><a href="attachements.html#cb5-169" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-170"><a href="attachements.html#cb5-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-171"><a href="attachements.html#cb5-171" aria-hidden="true" tabindex="-1"></a>filter_sens <span class="ot">&lt;-</span> <span class="cf">function</span>(sens_model, <span class="at">vars =</span> <span class="cn">NULL</span>, <span class="at">pars =</span> <span class="cn">NULL</span>){</span>
<span id="cb5-172"><a href="attachements.html#cb5-172" aria-hidden="true" tabindex="-1"></a>  sens_model <span class="ot">&lt;-</span> <span class="fu">select</span>(sens_model, <span class="sc">-</span>x)</span>
<span id="cb5-173"><a href="attachements.html#cb5-173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(vars)) {sens_model <span class="ot">&lt;-</span> <span class="fu">filter</span>(sens_model, var <span class="sc">%in%</span> vars)}</span>
<span id="cb5-174"><a href="attachements.html#cb5-174" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(pars)) {sens_model <span class="ot">&lt;-</span> <span class="fu">select</span>(sens_model, <span class="fu">all_of</span>(<span class="fu">c</span>(<span class="st">&quot;var&quot;</span>, pars)))}</span>
<span id="cb5-175"><a href="attachements.html#cb5-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sens_model)</span>
<span id="cb5-176"><a href="attachements.html#cb5-176" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-177"><a href="attachements.html#cb5-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-178"><a href="attachements.html#cb5-178" aria-hidden="true" tabindex="-1"></a>detailed_sens <span class="ot">&lt;-</span> <span class="cf">function</span>(sens_model, func){</span>
<span id="cb5-179"><a href="attachements.html#cb5-179" aria-hidden="true" tabindex="-1"></a>  sens_model <span class="sc">%&gt;%</span></span>
<span id="cb5-180"><a href="attachements.html#cb5-180" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(var) <span class="sc">%&gt;%</span></span>
<span id="cb5-181"><a href="attachements.html#cb5-181" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize_all</span>(func) <span class="sc">%&gt;%</span></span>
<span id="cb5-182"><a href="attachements.html#cb5-182" aria-hidden="true" tabindex="-1"></a>        invert_sens</span>
<span id="cb5-183"><a href="attachements.html#cb5-183" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-184"><a href="attachements.html#cb5-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-185"><a href="attachements.html#cb5-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-186"><a href="attachements.html#cb5-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-187"><a href="attachements.html#cb5-187" aria-hidden="true" tabindex="-1"></a>Kd_2stream <span class="ot">&lt;-</span> <span class="fu">get_two_stream_Kd</span>() <span class="co"># This is a costant value that depends only on the leaf angle distribution</span></span>
<span id="cb5-188"><a href="attachements.html#cb5-188" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; This is the rad_transf function that can take custom parameters from the input</span></span>
<span id="cb5-189"><a href="attachements.html#cb5-189" aria-hidden="true" tabindex="-1"></a>radiative_transfer_step_debug <span class="ot">&lt;-</span> <span class="cf">function</span>(input, state, pars, dt){</span>
<span id="cb5-190"><a href="attachements.html#cb5-190" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calc all the intermediate parameters</span></span>
<span id="cb5-191"><a href="attachements.html#cb5-191" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Possible optimization here as not all the paramaters changes every step</span></span>
<span id="cb5-192"><a href="attachements.html#cb5-192" aria-hidden="true" tabindex="-1"></a>    LAI <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">&quot;LAI&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(input), input<span class="sc">$</span>LAI, <span class="fu">get_day_LAI</span>(input<span class="sc">$</span>datetime, pars<span class="sc">$</span>max_LAI, pars<span class="sc">$</span>leaf_out, pars<span class="sc">$</span>leaf_full, pars<span class="sc">$</span>leaf_fall, pars<span class="sc">$</span>leaf_fall_complete))</span>
<span id="cb5-193"><a href="attachements.html#cb5-193" aria-hidden="true" tabindex="-1"></a>    radiation_PAI <span class="ot">&lt;-</span> <span class="fu">max</span>(LAI, pars<span class="sc">$</span>min_radiation_PAI) <span class="co"># During winter the are no leaves but there are still branches that interact with light</span></span>
<span id="cb5-194"><a href="attachements.html#cb5-194" aria-hidden="true" tabindex="-1"></a>    avg_datetime <span class="ot">&lt;-</span> input<span class="sc">$</span>datetime <span class="sc">-</span> <span class="fu">duration</span>(dt<span class="sc">/</span><span class="dv">2</span>) <span class="co"># calculating the zenith at the mid of the interval</span></span>
<span id="cb5-195"><a href="attachements.html#cb5-195" aria-hidden="true" tabindex="-1"></a>    zenith <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">&quot;zenith&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(input), input<span class="sc">$</span>zenith, <span class="fu">get_zenith</span>(avg_datetime, pars<span class="sc">$</span>lat, pars<span class="sc">$</span>lon))</span>
<span id="cb5-196"><a href="attachements.html#cb5-196" aria-hidden="true" tabindex="-1"></a>    Kb <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">&quot;Kb&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(input), input<span class="sc">$</span>Kd, <span class="fu">get_Kb</span>(zenith, <span class="at">max_Kb =</span> <span class="dv">1000</span>)) <span class="co"># 1000 is an arbitraty high number</span></span>
<span id="cb5-197"><a href="attachements.html#cb5-197" aria-hidden="true" tabindex="-1"></a>    Kd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">&quot;kd&quot;</span> <span class="sc">%in%</span> <span class="fu">names</span>(input), input<span class="sc">$</span>Kb, <span class="fu">get_Kd</span>(LAI))</span>
<span id="cb5-198"><a href="attachements.html#cb5-198" aria-hidden="true" tabindex="-1"></a>    omega_leaf <span class="ot">&lt;-</span> pars<span class="sc">$</span>rho_leaf <span class="sc">+</span> pars<span class="sc">$</span>tau_leaf</span>
<span id="cb5-199"><a href="attachements.html#cb5-199" aria-hidden="true" tabindex="-1"></a>    beta <span class="ot">&lt;-</span> <span class="fu">get_beta</span>(pars<span class="sc">$</span>rho_leaf, pars<span class="sc">$</span>tau_leaf)</span>
<span id="cb5-200"><a href="attachements.html#cb5-200" aria-hidden="true" tabindex="-1"></a>    beta0 <span class="ot">&lt;-</span> <span class="fu">get_beta0</span>(zenith, Kb, Kd_2stream, omega_leaf)</span>
<span id="cb5-201"><a href="attachements.html#cb5-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-202"><a href="attachements.html#cb5-202" aria-hidden="true" tabindex="-1"></a>    <span class="co"># the incoming shortwave is the total diffure + direct. Due to sensor errors the difference can be negative so the min possible value is set to 0</span></span>
<span id="cb5-203"><a href="attachements.html#cb5-203" aria-hidden="true" tabindex="-1"></a>    sw_sky_b <span class="ot">&lt;-</span> <span class="fu">max</span>(input<span class="sc">$</span>sw_in <span class="sc">-</span> input<span class="sc">$</span>sw_dif, <span class="dv">0</span>)</span>
<span id="cb5-204"><a href="attachements.html#cb5-204" aria-hidden="true" tabindex="-1"></a>    shortwave <span class="ot">&lt;-</span> <span class="fu">shortwave_radiation</span>(sw_sky_b, input<span class="sc">$</span>sw_dif, radiation_PAI, Kb, Kd_2stream, beta, beta0 , omega_leaf,</span>
<span id="cb5-205"><a href="attachements.html#cb5-205" aria-hidden="true" tabindex="-1"></a>                                     pars<span class="sc">$</span>clump_OMEGA, pars<span class="sc">$</span>alb_soil_b, pars<span class="sc">$</span>alb_soil_d)</span>
<span id="cb5-206"><a href="attachements.html#cb5-206" aria-hidden="true" tabindex="-1"></a>    longwave <span class="ot">&lt;-</span> <span class="fu">longwave_radiation</span>(input<span class="sc">$</span>lw_in, radiation_PAI, state<span class="sc">$</span>t_leaf, state<span class="sc">$</span>t_soil, Kb, Kd, pars<span class="sc">$</span>em_leaf, pars<span class="sc">$</span>em_soil)</span>
<span id="cb5-207"><a href="attachements.html#cb5-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-208"><a href="attachements.html#cb5-208" aria-hidden="true" tabindex="-1"></a>    LAI_sunlit <span class="ot">&lt;-</span> <span class="fu">get_LAI_sunlit</span>(LAI, Kb, pars<span class="sc">$</span>clump_OMEGA)</span>
<span id="cb5-209"><a href="attachements.html#cb5-209" aria-hidden="true" tabindex="-1"></a>    vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">LAI=</span>LAI, <span class="at">LAI_sunlit=</span>LAI_sunlit, <span class="at">radiation_PAI =</span> radiation_PAI, <span class="at">Kb=</span>Kb, <span class="at">Kd=</span>Kd, <span class="at">beta=</span>beta, <span class="at">beta0=</span> beta0, <span class="at">zenith=</span>zenith)</span>
<span id="cb5-210"><a href="attachements.html#cb5-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-211"><a href="attachements.html#cb5-211" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="fu">c</span>(shortwave, longwave, vars)))</span>
<span id="cb5-212"><a href="attachements.html#cb5-212" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-213"><a href="attachements.html#cb5-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-214"><a href="attachements.html#cb5-214" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; Adds a white and black background when is night</span></span>
<span id="cb5-215"><a href="attachements.html#cb5-215" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; data should be a dataframe with datetime and the night column without repetitions (eg. not in tidy format)</span></span>
<span id="cb5-216"><a href="attachements.html#cb5-216" aria-hidden="true" tabindex="-1"></a> night_bg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">y_mean=</span><span class="dv">0</span>){</span>
<span id="cb5-217"><a href="attachements.html#cb5-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb5-218"><a href="attachements.html#cb5-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="fu">aes</span>(<span class="at">x=</span> datetime, <span class="at">width =</span> dt, <span class="at">y =</span> y_mean, <span class="at">height =</span> <span class="cn">Inf</span>, <span class="at">fill =</span> night), <span class="at">alpha =</span> .<span class="dv">4</span>, <span class="at">linetype =</span> <span class="dv">0</span>, <span class="at">data=</span>data),</span>
<span id="cb5-219"><a href="attachements.html#cb5-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#ececec&quot;</span>, <span class="st">&quot;#555555&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;day&quot;</span>, <span class="st">&quot;night&quot;</span>),</span>
<span id="cb5-220"><a href="attachements.html#cb5-220" aria-hidden="true" tabindex="-1"></a>                    <span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">colour =</span> <span class="fu">c</span>(<span class="st">&quot;#ececec&quot;</span>, <span class="st">&quot;#b9b9b9&quot;</span>), <span class="at">alpha =</span> .<span class="dv">4</span>)))</span>
<span id="cb5-221"><a href="attachements.html#cb5-221" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-222"><a href="attachements.html#cb5-222" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-223"><a href="attachements.html#cb5-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-224"><a href="attachements.html#cb5-224" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="ot">&lt;-</span> <span class="cf">function</span>(labels, <span class="at">name=</span><span class="st">&quot;&quot;</span>, <span class="at">max_width =</span> <span class="dv">10</span>){</span>
<span id="cb5-225"><a href="attachements.html#cb5-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb5-226"><a href="attachements.html#cb5-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_hue</span>(<span class="at">labels =</span> <span class="fu">str_wrap</span>(labels, max_width), <span class="fu">str_wrap</span>(name, max_width)),</span>
<span id="cb5-227"><a href="attachements.html#cb5-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">40</span>, <span class="st">&quot;pt&quot;</span>))</span>
<span id="cb5-228"><a href="attachements.html#cb5-228" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-229"><a href="attachements.html#cb5-229" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-230"><a href="attachements.html#cb5-230" aria-hidden="true" tabindex="-1"></a><span class="co"># breaks_12hours &lt;- function (limits){</span></span>
<span id="cb5-231"><a href="attachements.html#cb5-231" aria-hidden="true" tabindex="-1"></a><span class="co">#   seq(limits[1], limits[2], by=&quot;12 hours&quot;)</span></span>
<span id="cb5-232"><a href="attachements.html#cb5-232" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb5-233"><a href="attachements.html#cb5-233" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb5-234"><a href="attachements.html#cb5-234" aria-hidden="true" tabindex="-1"></a><span class="co"># labels_12hours &lt;- function (limits){</span></span>
<span id="cb5-235"><a href="attachements.html#cb5-235" aria-hidden="true" tabindex="-1"></a><span class="co">#   format(breaks_12hours(limits), &quot;%d %b %Ih&quot;)</span></span>
<span id="cb5-236"><a href="attachements.html#cb5-236" aria-hidden="true" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
</div>
<div id="markdown" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Markdown</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="attachements.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;radiative_transfer/term paper/radiation_utils_test_data.R&quot;</span>)</span>
<span id="cb6-2"><a href="attachements.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(FME)</span>
<span id="cb6-3"><a href="attachements.html#cb6-3" aria-hidden="true" tabindex="-1"></a>days <span class="ot">&lt;-</span> <span class="fu">seq.Date</span>(<span class="fu">as.Date</span>(<span class="st">&quot;2020-01-01&quot;</span>), <span class="fu">as.Date</span>(<span class="st">&quot;2020-12-31&quot;</span>), <span class="at">by=</span><span class="dv">1</span>)</span>
<span id="cb6-4"><a href="attachements.html#cb6-4" aria-hidden="true" tabindex="-1"></a>LAI <span class="ot">&lt;-</span> <span class="fu">pmax</span>(<span class="fu">Vectorize</span>(get_day_LAI, <span class="st">&quot;datetime&quot;</span>)</span>
<span id="cb6-5"><a href="attachements.html#cb6-5" aria-hidden="true" tabindex="-1"></a>            (days, pars<span class="sc">$</span>max_LAI, pars<span class="sc">$</span>leaf_out, pars<span class="sc">$</span>leaf_full, pars<span class="sc">$</span>leaf_fall, pars<span class="sc">$</span>leaf_fall_complete), pars<span class="sc">$</span>min_radiation_PAI)</span>
<span id="cb6-6"><a href="attachements.html#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="attachements.html#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> days, <span class="at">y =</span> LAI)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="attachements.html#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fu">c</span>(<span class="dv">0</span>, pars<span class="sc">$</span>max_LAI)) <span class="sc">+</span></span>
<span id="cb6-9"><a href="attachements.html#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;LAI over the year&quot;</span>)</span>
<span id="cb6-10"><a href="attachements.html#cb6-10" aria-hidden="true" tabindex="-1"></a>sens_p <span class="ot">&lt;-</span> pars[<span class="fu">c</span>(<span class="st">&quot;rho_leaf&quot;</span>, <span class="st">&quot;tau_leaf&quot;</span>, <span class="st">&quot;alb_soil_b&quot;</span>, <span class="st">&quot;alb_soil_d&quot;</span>, <span class="st">&quot;em_leaf&quot;</span>, <span class="st">&quot;em_soil&quot;</span>)]</span>
<span id="cb6-11"><a href="attachements.html#cb6-11" aria-hidden="true" tabindex="-1"></a>sens_model <span class="ot">&lt;-</span> <span class="fu">sensFun</span>(rad_transf_new_p_1m, sens_p, <span class="at">map=</span><span class="cn">NULL</span>)</span>
<span id="cb6-12"><a href="attachements.html#cb6-12" aria-hidden="true" tabindex="-1"></a>sens_sum <span class="ot">&lt;-</span> <span class="fu">summary</span>(sens_model)</span>
<span id="cb6-13"><a href="attachements.html#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind(par = attr(sens_sum, &quot;row.names&quot;), sens_sum) #little hack because pycharm doesn&#39;t show row names properly</span></span>
<span id="cb6-14"><a href="attachements.html#cb6-14" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb6-15"><a href="attachements.html#cb6-15" aria-hidden="true" tabindex="-1"></a>  sens_sum, <span class="at">booktabs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb6-16"><a href="attachements.html#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb6-17"><a href="attachements.html#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&#39;Aggregated model sensitivity.&#39;</span></span>
<span id="cb6-18"><a href="attachements.html#cb6-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-19"><a href="attachements.html#cb6-19" aria-hidden="true" tabindex="-1"></a>sens_sw <span class="ot">&lt;-</span> <span class="fu">filter_sens</span>(sens_model, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;i_down&quot;</span>, <span class="st">&quot;i_up&quot;</span>, <span class="st">&quot;ic&quot;</span>, <span class="st">&quot;ic_sha&quot;</span>, <span class="st">&quot;ic_sun&quot;</span>, <span class="st">&quot;ig&quot;</span>),</span>
<span id="cb6-20"><a href="attachements.html#cb6-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;rho_leaf&quot;</span>, <span class="st">&quot;tau_leaf&quot;</span> ,<span class="st">&quot;alb_soil_b&quot;</span>, <span class="st">&quot;alb_soil_d&quot;</span>))</span>
<span id="cb6-21"><a href="attachements.html#cb6-21" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">detailed_sens</span>(sens_sw, mean), <span class="at">caption =</span> <span class="st">&quot;Shortwave sensitivity aggregated by mean&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb6-22"><a href="attachements.html#cb6-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">detailed_sens</span>(sens_sw, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">abs</span>(x))), <span class="at">caption =</span> <span class="st">&quot;Shortwave sensitivity aggregated by L1&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb6-23"><a href="attachements.html#cb6-23" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">detailed_sens</span>(sens_sw, <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">mean</span>(x<span class="sc">^</span><span class="dv">2</span>))), <span class="at">caption =</span> <span class="st">&quot;Shortwave sensitivity aggregated by L2&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb6-24"><a href="attachements.html#cb6-24" aria-hidden="true" tabindex="-1"></a>sens_lw <span class="ot">&lt;-</span> <span class="fu">filter_sens</span>(sens_model, <span class="at">vars =</span> <span class="fu">c</span>(<span class="st">&quot;l_down&quot;</span>, <span class="st">&quot;l_up&quot;</span>, <span class="st">&quot;lc&quot;</span>, <span class="st">&quot;lc_sha&quot;</span>, <span class="st">&quot;lc_sun&quot;</span>, <span class="st">&quot;lg&quot;</span>),</span>
<span id="cb6-25"><a href="attachements.html#cb6-25" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">&quot;em_leaf&quot;</span>, <span class="st">&quot;em_soil&quot;</span>))</span>
<span id="cb6-26"><a href="attachements.html#cb6-26" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">detailed_sens</span>(sens_lw, mean), <span class="at">caption =</span> <span class="st">&quot;Longwave sensitivity aggregated by mean&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb6-27"><a href="attachements.html#cb6-27" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">detailed_sens</span>(sens_lw, <span class="cf">function</span>(x) <span class="fu">mean</span>(<span class="fu">abs</span>(x))), <span class="at">caption =</span> <span class="st">&quot;Longwave sensitivity aggregated by L1&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb6-28"><a href="attachements.html#cb6-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">detailed_sens</span>(sens_lw, <span class="cf">function</span>(x) <span class="fu">sqrt</span>(<span class="fu">mean</span>(x<span class="sc">^</span><span class="dv">2</span>))), <span class="at">caption =</span> <span class="st">&quot;Longwave sensitivity aggregated by L2&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb6-29"><a href="attachements.html#cb6-29" aria-hidden="true" tabindex="-1"></a>cal_p_sw <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">rho_leaf =</span> <span class="fl">0.4</span>, <span class="at">tau_leaf =</span> <span class="fl">0.1</span>)</span>
<span id="cb6-30"><a href="attachements.html#cb6-30" aria-hidden="true" tabindex="-1"></a>cal_p_sw_lower <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">rho_leaf =</span> <span class="fl">0.38</span>, <span class="at">tau_leaf =</span> <span class="fl">0.05</span> )</span>
<span id="cb6-31"><a href="attachements.html#cb6-31" aria-hidden="true" tabindex="-1"></a>cal_p_sw_upper <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">rho_leaf =</span> <span class="fl">0.42</span>, <span class="at">tau_leaf =</span> <span class="fl">0.2</span>)</span>
<span id="cb6-32"><a href="attachements.html#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="attachements.html#cb6-33" aria-hidden="true" tabindex="-1"></a>model_cost_sw <span class="ot">&lt;-</span> <span class="cf">function</span> (params){</span>
<span id="cb6-34"><a href="attachements.html#cb6-34" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> <span class="fu">rad_transf_new_p_1m</span>(params)</span>
<span id="cb6-35"><a href="attachements.html#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out<span class="sc">$</span>i_up <span class="sc">-</span> fluxes<span class="sc">$</span>sw_out)</span>
<span id="cb6-36"><a href="attachements.html#cb6-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-37"><a href="attachements.html#cb6-37" aria-hidden="true" tabindex="-1"></a>mfit_sw <span class="ot">&lt;-</span> <span class="fu">modFit</span>(model_cost_sw, cal_p_sw, cal_p_sw_lower, cal_p_sw_upper)</span>
<span id="cb6-38"><a href="attachements.html#cb6-38" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(</span>
<span id="cb6-39"><a href="attachements.html#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>(mfit_sw)<span class="sc">$</span>par[,<span class="dv">1</span>],</span>
<span id="cb6-40"><a href="attachements.html#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">&quot;Shortwave parameters after calibration&quot;</span></span>
<span id="cb6-41"><a href="attachements.html#cb6-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-42"><a href="attachements.html#cb6-42" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&#39;radiative_transfer/term paper/radiation_utils_test_data.R&#39;</span>)</span>
<span id="cb6-43"><a href="attachements.html#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="co"># library(scales)</span></span>
<span id="cb6-44"><a href="attachements.html#cb6-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tsibble)</span>
<span id="cb6-45"><a href="attachements.html#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hydroGOF)</span>
<span id="cb6-46"><a href="attachements.html#cb6-46" aria-hidden="true" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">rad_transf_new_p</span>()</span>
<span id="cb6-47"><a href="attachements.html#cb6-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-48"><a href="attachements.html#cb6-48" aria-hidden="true" tabindex="-1"></a>out_plot <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">datetime =</span> input<span class="sc">$</span>datetime, <span class="at">night =</span> input<span class="sc">$</span>night, <span class="at">mod_sw_out =</span> out<span class="sc">$</span>i_up, <span class="at">obs_sw_out =</span> fluxes<span class="sc">$</span>sw_out, <span class="at">mod_lw_out =</span> out<span class="sc">$</span>l_up, <span class="at">obs_lw_out =</span> fluxes<span class="sc">$</span>lw_out)</span>
<span id="cb6-49"><a href="attachements.html#cb6-49" aria-hidden="true" tabindex="-1"></a>out_all <span class="ot">&lt;-</span> <span class="fu">cbind</span>(input, <span class="fu">select</span>(fluxes, <span class="sc">-</span>time, <span class="sc">-</span>Date.Time), out)</span>
<span id="cb6-50"><a href="attachements.html#cb6-50" aria-hidden="true" tabindex="-1"></a>out_1week <span class="ot">&lt;-</span> <span class="fu">filter</span>(out_all, datetime <span class="sc">&gt;</span> <span class="fu">as_date</span>(<span class="st">&quot;2018-07-1&quot;</span>) <span class="sc">&amp;</span> datetime <span class="sc">&lt;</span> <span class="fu">as_date</span>(<span class="st">&quot;2018-07-8&quot;</span>))</span>
<span id="cb6-51"><a href="attachements.html#cb6-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-52"><a href="attachements.html#cb6-52" aria-hidden="true" tabindex="-1"></a>out_1year_wk <span class="ot">&lt;-</span> out_all <span class="sc">%&gt;%</span> <span class="co"># to day average</span></span>
<span id="cb6-53"><a href="attachements.html#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(night, time)) <span class="sc">%&gt;%</span></span>
<span id="cb6-54"><a href="attachements.html#cb6-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tsibble</span>(<span class="at">index =</span> datetime) <span class="sc">%&gt;%</span></span>
<span id="cb6-55"><a href="attachements.html#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">index_by</span>(<span class="at">week =</span> <span class="sc">~</span> <span class="fu">yearweek</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb6-56"><a href="attachements.html#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-57"><a href="attachements.html#cb6-57" aria-hidden="true" tabindex="-1"></a>out_1week <span class="sc">%&gt;%</span></span>
<span id="cb6-58"><a href="attachements.html#cb6-58" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, sw_in, ic, i_up, ig, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-59"><a href="attachements.html#cb6-59" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-60"><a href="attachements.html#cb6-60" aria-hidden="true" tabindex="-1"></a>        <span class="fu">night_bg</span>(out_1week) <span class="sc">+</span></span>
<span id="cb6-61"><a href="attachements.html#cb6-61" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-62"><a href="attachements.html#cb6-62" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="fu">c</span>(<span class="st">&quot;Incoming sw&quot;</span>, <span class="st">&quot;Absorbed sw canopy&quot;</span>, <span class="st">&quot;Upward sw&quot;</span>, <span class="st">&quot;Absorbed sw soil&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-63"><a href="attachements.html#cb6-63" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Datetime&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Shortwave radiation (W m-2)&quot;</span>, <span class="at">title =</span> <span class="st">&quot;Shortwave one week&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Modeled output variables (1-8 Jul 2018)&quot;</span>)</span>
<span id="cb6-64"><a href="attachements.html#cb6-64" aria-hidden="true" tabindex="-1"></a>lai_breaks <span class="ot">&lt;-</span> <span class="fu">as_datetime</span>(<span class="fu">c</span>(<span class="st">&quot;2018-04-19&quot;</span>, <span class="st">&quot;2018-06-19&quot;</span>, <span class="st">&quot;2018-10-7&quot;</span>, <span class="st">&quot;2018-10-28&quot;</span>))</span>
<span id="cb6-65"><a href="attachements.html#cb6-65" aria-hidden="true" tabindex="-1"></a>lai_breaks_lbl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;leaf out&quot;</span>, <span class="st">&quot;leaf complete&quot;</span>, <span class="st">&quot;leaf fall&quot;</span>, <span class="st">&quot;leaf fall complete&quot;</span>)</span>
<span id="cb6-66"><a href="attachements.html#cb6-66" aria-hidden="true" tabindex="-1"></a>pos <span class="ot">&lt;-</span> <span class="cf">function</span> (x) {x<span class="sc">+</span><span class="dv">10</span>}</span>
<span id="cb6-67"><a href="attachements.html#cb6-67" aria-hidden="true" tabindex="-1"></a>out_1year_wk <span class="sc">%&gt;%</span></span>
<span id="cb6-68"><a href="attachements.html#cb6-68" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, , sw_in, ic, i_up, ig, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-69"><a href="attachements.html#cb6-69" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-70"><a href="attachements.html#cb6-70" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> lai_breaks, <span class="at">linetype=</span><span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">8</span>, <span class="at">size=</span>.<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb6-71"><a href="attachements.html#cb6-71" aria-hidden="true" tabindex="-1"></a>        <span class="fu">annotate</span>(<span class="st">&#39;label&#39;</span>, <span class="at">x=</span>lai_breaks, <span class="at">y=</span><span class="fu">c</span>(<span class="dv">315</span>, <span class="dv">315</span>, <span class="dv">315</span>, <span class="dv">290</span>), <span class="at">label =</span> lai_breaks_lbl) <span class="sc">+</span> <span class="co">#make the last lable lower to avoid overlap</span></span>
<span id="cb6-72"><a href="attachements.html#cb6-72" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-73"><a href="attachements.html#cb6-73" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="fu">c</span>(<span class="st">&quot;Incoming sw&quot;</span>, <span class="st">&quot;Absorbed sw canopy&quot;</span>, <span class="st">&quot;Upward sw&quot;</span>, <span class="st">&quot;Absorbed sw soil&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-74"><a href="attachements.html#cb6-74" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x=</span> <span class="st">&quot;Datetime&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Shortwave radiation (W m-2)&quot;</span>,</span>
<span id="cb6-75"><a href="attachements.html#cb6-75" aria-hidden="true" tabindex="-1"></a>             <span class="at">title=</span><span class="st">&quot;Shortwave one year&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Modeled output variables, weekly average 2018&quot;</span>)</span>
<span id="cb6-76"><a href="attachements.html#cb6-76" aria-hidden="true" tabindex="-1"></a>out_1week <span class="sc">%&gt;%</span></span>
<span id="cb6-77"><a href="attachements.html#cb6-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, lw_in, l_up, lc, lg, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-78"><a href="attachements.html#cb6-78" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-79"><a href="attachements.html#cb6-79" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-80"><a href="attachements.html#cb6-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">night_bg</span>(out_1week) <span class="sc">+</span></span>
<span id="cb6-81"><a href="attachements.html#cb6-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-82"><a href="attachements.html#cb6-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Datetime&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Longwave radiation (w m-2)&quot;</span>,</span>
<span id="cb6-83"><a href="attachements.html#cb6-83" aria-hidden="true" tabindex="-1"></a>             <span class="at">title =</span> <span class="st">&quot;Longwave one week&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Modeled output variables (1-8 Jul 2018)&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-84"><a href="attachements.html#cb6-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="fu">c</span>(<span class="st">&quot;Incoming lw&quot;</span>, <span class="st">&quot;Upward lw&quot;</span>, <span class="st">&quot;Absorbed lw canopy&quot;</span>, <span class="st">&quot;Absorbed lw soil&quot;</span>))</span>
<span id="cb6-85"><a href="attachements.html#cb6-85" aria-hidden="true" tabindex="-1"></a>out_1year_wk <span class="sc">%&gt;%</span></span>
<span id="cb6-86"><a href="attachements.html#cb6-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, lw_in, l_up, lc, lg, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-87"><a href="attachements.html#cb6-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-88"><a href="attachements.html#cb6-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb6-89"><a href="attachements.html#cb6-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-90"><a href="attachements.html#cb6-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Datetime&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Longwave radiation (w m-2)&quot;</span>,</span>
<span id="cb6-91"><a href="attachements.html#cb6-91" aria-hidden="true" tabindex="-1"></a>   <span class="at">title=</span><span class="st">&quot;Shortwave one year&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Modeled output variables, weekly average 2018&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-92"><a href="attachements.html#cb6-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">legend_labels</span>(<span class="fu">c</span>(<span class="st">&quot;Incoming lw&quot;</span>, <span class="st">&quot;Upward lw&quot;</span>, <span class="st">&quot;Absorbed lw canopy&quot;</span>, <span class="st">&quot;Absorbed lw soil&quot;</span>))</span>
<span id="cb6-93"><a href="attachements.html#cb6-93" aria-hidden="true" tabindex="-1"></a>out_1week <span class="sc">%&gt;%</span></span>
<span id="cb6-94"><a href="attachements.html#cb6-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, i_up, sw_out, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-95"><a href="attachements.html#cb6-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-96"><a href="attachements.html#cb6-96" aria-hidden="true" tabindex="-1"></a>        <span class="fu">night_bg</span>(out_1week) <span class="sc">+</span></span>
<span id="cb6-97"><a href="attachements.html#cb6-97" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-98"><a href="attachements.html#cb6-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Outgoing shortwave radiation (w m-2)&quot;</span>,</span>
<span id="cb6-99"><a href="attachements.html#cb6-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">title=</span> <span class="st">&quot;Modeled vs Observed outgoing shortwave radiation&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;1 summer week (1-8 Jul 2018)&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-100"><a href="attachements.html#cb6-100" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Modelled&quot;</span>, <span class="st">&quot;Observed&quot;</span>), <span class="st">&quot;Outgoing shortwave radiation&quot;</span>)</span>
<span id="cb6-101"><a href="attachements.html#cb6-101" aria-hidden="true" tabindex="-1"></a>out_1year_wk <span class="sc">%&gt;%</span></span>
<span id="cb6-102"><a href="attachements.html#cb6-102" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, i_up, sw_out, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-103"><a href="attachements.html#cb6-103" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-104"><a href="attachements.html#cb6-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-105"><a href="attachements.html#cb6-105" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Outgoing shortwave radiation (w m-2)&quot;</span>,</span>
<span id="cb6-106"><a href="attachements.html#cb6-106" aria-hidden="true" tabindex="-1"></a>             <span class="at">title=</span> <span class="st">&quot;Modeled vs Observed outgoing shortwave radiation&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;weekly average 2018&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-107"><a href="attachements.html#cb6-107" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Modelled&quot;</span>, <span class="st">&quot;Observed&quot;</span>), <span class="st">&quot;Outgoing shortwave radiation&quot;</span>)</span>
<span id="cb6-108"><a href="attachements.html#cb6-108" aria-hidden="true" tabindex="-1"></a>sw_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs_sw_out <span class="sc">~</span> mod_sw_out, <span class="at">data =</span> out_plot)</span>
<span id="cb6-109"><a href="attachements.html#cb6-109" aria-hidden="true" tabindex="-1"></a>sw_r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">summary</span>(sw_lm)<span class="sc">$</span>r.squared, <span class="dv">2</span>)</span>
<span id="cb6-110"><a href="attachements.html#cb6-110" aria-hidden="true" tabindex="-1"></a>sw_slope <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coef</span>(sw_lm)[<span class="dv">2</span>], <span class="dv">2</span>)</span>
<span id="cb6-111"><a href="attachements.html#cb6-111" aria-hidden="true" tabindex="-1"></a>sw_intercept <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coef</span>(sw_lm)[<span class="dv">1</span>], <span class="dv">2</span>)</span>
<span id="cb6-112"><a href="attachements.html#cb6-112" aria-hidden="true" tabindex="-1"></a>sw_rmse <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>((out_plot<span class="sc">$</span>obs_sw_out <span class="sc">-</span> out_plot<span class="sc">$</span>mod_sw_out)<span class="sc">^</span><span class="dv">2</span>)), <span class="dv">2</span>)</span>
<span id="cb6-113"><a href="attachements.html#cb6-113" aria-hidden="true" tabindex="-1"></a>sw_nse <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">NSE</span>(out_plot<span class="sc">$</span>mod_sw_out, out_plot<span class="sc">$</span>obs_sw_out), <span class="dv">2</span>) <span class="co"># Nash-Sutcliffe Efficiency</span></span>
<span id="cb6-114"><a href="attachements.html#cb6-114" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(out_plot) <span class="sc">+</span></span>
<span id="cb6-115"><a href="attachements.html#cb6-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;Theory&quot;</span>), <span class="at">key_glyph =</span> <span class="st">&quot;path&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-116"><a href="attachements.html#cb6-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mod_sw_out, <span class="at">y =</span> obs_sw_out), <span class="at">size=</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb6-117"><a href="attachements.html#cb6-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> mod_sw_out, <span class="at">y =</span> obs_sw_out, <span class="at">color =</span> <span class="st">&quot;Regression&quot;</span>), <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb6-118"><a href="attachements.html#cb6-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Outgoing sw modeled vs observed&quot;</span>,</span>
<span id="cb6-119"><a href="attachements.html#cb6-119" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;slope: &quot;</span>, sw_slope, <span class="st">&quot; intercept: &quot;</span>, sw_intercept, <span class="st">&quot; r2: &quot;</span>, sw_r2, <span class="st">&quot; . Data from 2018.&quot;</span>), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb6-120"><a href="attachements.html#cb6-120" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Modelled outgoing shortwave (W m-2)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Observed outgoing sw (W m-2)&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;Legend&quot;</span>)</span>
<span id="cb6-121"><a href="attachements.html#cb6-121" aria-hidden="true" tabindex="-1"></a>out_1week <span class="sc">%&gt;%</span></span>
<span id="cb6-122"><a href="attachements.html#cb6-122" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, l_up, lw_out, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-123"><a href="attachements.html#cb6-123" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-124"><a href="attachements.html#cb6-124" aria-hidden="true" tabindex="-1"></a>        <span class="fu">night_bg</span>(out_1week, <span class="at">y_mean =</span> <span class="dv">400</span>) <span class="sc">+</span></span>
<span id="cb6-125"><a href="attachements.html#cb6-125" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-126"><a href="attachements.html#cb6-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Outgoing shortwave radiation (w m-2)&quot;</span>,</span>
<span id="cb6-127"><a href="attachements.html#cb6-127" aria-hidden="true" tabindex="-1"></a>             <span class="at">title=</span> <span class="st">&quot;Modeled vs Observed outgoing longwave radiation&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;1 summer week (1-8 Jul 2018)&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-128"><a href="attachements.html#cb6-128" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Modelled&quot;</span>, <span class="st">&quot;Observed&quot;</span>), <span class="st">&quot;Outgoing longwave radiation&quot;</span>)</span>
<span id="cb6-129"><a href="attachements.html#cb6-129" aria-hidden="true" tabindex="-1"></a>out_1year_wk <span class="sc">%&gt;%</span></span>
<span id="cb6-130"><a href="attachements.html#cb6-130" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">&quot;type&quot;</span>, <span class="at">value =</span> <span class="st">&quot;radiation&quot;</span>, l_up, lw_out, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-131"><a href="attachements.html#cb6-131" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-132"><a href="attachements.html#cb6-132" aria-hidden="true" tabindex="-1"></a>        <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> datetime, <span class="at">y =</span> radiation, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb6-133"><a href="attachements.html#cb6-133" aria-hidden="true" tabindex="-1"></a>        <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Outgoing shortwave radiation (w m-2)&quot;</span>,</span>
<span id="cb6-134"><a href="attachements.html#cb6-134" aria-hidden="true" tabindex="-1"></a>             <span class="at">title=</span> <span class="st">&quot;Modeled vs Observed outgoing longwave radiation&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;weekly average 2018&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-135"><a href="attachements.html#cb6-135" aria-hidden="true" tabindex="-1"></a>        <span class="fu">legend_labels</span>(<span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Modelled&quot;</span>, <span class="st">&quot;Observed&quot;</span>), <span class="st">&quot;Outgoing shortwave radiation&quot;</span>)</span>
<span id="cb6-136"><a href="attachements.html#cb6-136" aria-hidden="true" tabindex="-1"></a>lw_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(obs_lw_out <span class="sc">~</span> mod_lw_out, <span class="at">data =</span> out_plot)</span>
<span id="cb6-137"><a href="attachements.html#cb6-137" aria-hidden="true" tabindex="-1"></a>lw_r2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">summary</span>(lw_lm)<span class="sc">$</span>r.squared, <span class="dv">2</span>)</span>
<span id="cb6-138"><a href="attachements.html#cb6-138" aria-hidden="true" tabindex="-1"></a>lw_slope <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coef</span>(lw_lm)[<span class="dv">2</span>], <span class="dv">2</span>)</span>
<span id="cb6-139"><a href="attachements.html#cb6-139" aria-hidden="true" tabindex="-1"></a>lw_intercept <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">coef</span>(lw_lm)[<span class="dv">1</span>], <span class="dv">2</span>)</span>
<span id="cb6-140"><a href="attachements.html#cb6-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-141"><a href="attachements.html#cb6-141" aria-hidden="true" tabindex="-1"></a>lw_rmse <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">sqrt</span>(<span class="fu">mean</span>((out_plot<span class="sc">$</span>obs_lw_out <span class="sc">-</span> out_plot<span class="sc">$</span>mod_lw_out)<span class="sc">^</span><span class="dv">2</span>)), <span class="dv">2</span>)</span>
<span id="cb6-142"><a href="attachements.html#cb6-142" aria-hidden="true" tabindex="-1"></a>lw_nse <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">NSE</span>(out_plot<span class="sc">$</span>mod_lw_out, out_plot<span class="sc">$</span>obs_lw_out), <span class="dv">2</span>)<span class="co"># Nash-Sutcliffe Efficiency</span></span>
<span id="cb6-143"><a href="attachements.html#cb6-143" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(out_plot) <span class="sc">+</span></span>
<span id="cb6-144"><a href="attachements.html#cb6-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="fu">aes</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;Theory&quot;</span>), <span class="at">key_glyph =</span> <span class="st">&quot;path&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-145"><a href="attachements.html#cb6-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> mod_lw_out, <span class="at">y =</span> obs_lw_out), <span class="at">size=</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb6-146"><a href="attachements.html#cb6-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="fu">aes</span>(<span class="at">x =</span> mod_lw_out, <span class="at">y =</span> obs_lw_out, <span class="at">color =</span> <span class="st">&quot;Regression&quot;</span>), <span class="at">formula =</span> y <span class="sc">~</span> x, <span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">se =</span> F) <span class="sc">+</span></span>
<span id="cb6-147"><a href="attachements.html#cb6-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Outgoing lw modeled vs observed&quot;</span>,</span>
<span id="cb6-148"><a href="attachements.html#cb6-148" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="fu">c</span>(<span class="st">&quot;slope: &quot;</span>, lw_slope, <span class="st">&quot; intercept: &quot;</span>, lw_intercept, <span class="st">&quot; r2: &quot;</span>, lw_r2, <span class="st">&quot; . Data from 2018.&quot;</span>), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb6-149"><a href="attachements.html#cb6-149" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;Modeled outgoing longwave (W m-2)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Observed outgoing lw (W m-2)&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;Legend&quot;</span>)</span>
<span id="cb6-150"><a href="attachements.html#cb6-150" aria-hidden="true" tabindex="-1"></a>zenith <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">85</span>)</span>
<span id="cb6-151"><a href="attachements.html#cb6-151" aria-hidden="true" tabindex="-1"></a>Kb <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(zenith, get_Kb)</span>
<span id="cb6-152"><a href="attachements.html#cb6-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-153"><a href="attachements.html#cb6-153" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-154"><a href="attachements.html#cb6-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> zenith , <span class="at">y =</span> Kb)) <span class="sc">+</span></span>
<span id="cb6-155"><a href="attachements.html#cb6-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Kb over zenith&quot;</span>, <span class="at">x=</span><span class="st">&quot;Zenith (degrees)&quot;</span>)<span class="sc">+</span></span>
<span id="cb6-156"><a href="attachements.html#cb6-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">n.breaks =</span> <span class="dv">7</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>))</span>
<span id="cb6-157"><a href="attachements.html#cb6-157" aria-hidden="true" tabindex="-1"></a>LAI <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>,<span class="dv">10</span>,.<span class="dv">25</span>)</span>
<span id="cb6-158"><a href="attachements.html#cb6-158" aria-hidden="true" tabindex="-1"></a>Kd <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(LAI, get_Kd)</span>
<span id="cb6-159"><a href="attachements.html#cb6-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-160"><a href="attachements.html#cb6-160" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-161"><a href="attachements.html#cb6-161" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> LAI, <span class="at">y =</span> Kd)) <span class="sc">+</span></span>
<span id="cb6-162"><a href="attachements.html#cb6-162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Kd over LAI&quot;</span>)</span>
<span id="cb6-163"><a href="attachements.html#cb6-163" aria-hidden="true" tabindex="-1"></a>fake_input_5 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-164"><a href="attachements.html#cb6-164" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-07-15 12:00&quot;</span>), <span class="at">sw_in =</span> <span class="dv">1000</span>, <span class="at">sw_dif =</span> <span class="dv">100</span>, <span class="at">lw_in =</span> <span class="dv">0</span>, <span class="at">t_soil =</span> <span class="dv">0</span>, <span class="at">t_leaf =</span> <span class="dv">0</span>, <span class="at">zenith =</span> <span class="dv">30</span>,</span>
<span id="cb6-165"><a href="attachements.html#cb6-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">LAI =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb6-166"><a href="attachements.html#cb6-166" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-167"><a href="attachements.html#cb6-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-168"><a href="attachements.html#cb6-168" aria-hidden="true" tabindex="-1"></a>out_2 <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">rad_transf</span>(<span class="at">input =</span> fake_input_5), <span class="at">sw_in =</span> fake_input_5<span class="sc">$</span>sw_in)</span>
<span id="cb6-169"><a href="attachements.html#cb6-169" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(<span class="fu">c</span>(<span class="st">&quot;Total incoming sw&quot;</span>, <span class="st">&quot;Total absorbed sw&quot;</span>, <span class="st">&quot;Absorbed sw sunlit canopy&quot;</span>, <span class="st">&quot;Absorbed sw shaded canopy&quot;</span>), <span class="dv">8</span>)</span>
<span id="cb6-170"><a href="attachements.html#cb6-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-171"><a href="attachements.html#cb6-171" aria-hidden="true" tabindex="-1"></a>out_2 <span class="sc">%&gt;%</span></span>
<span id="cb6-172"><a href="attachements.html#cb6-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&quot;type&quot;</span>, <span class="st">&quot;radiation&quot;</span>, sw_in, ic, ic_sun, ic_sha, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-173"><a href="attachements.html#cb6-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-174"><a href="attachements.html#cb6-174" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> LAI, <span class="at">y =</span> radiation, <span class="at">color =</span> type, <span class="at">linetype =</span> type)) <span class="sc">+</span></span>
<span id="cb6-175"><a href="attachements.html#cb6-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-176"><a href="attachements.html#cb6-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Absorbed shortwave with increasing LAI&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Incoming radiation 900 direct + 100 diffuse. Zenith 30°&quot;</span>,</span>
<span id="cb6-177"><a href="attachements.html#cb6-177" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;LAI (m2 m-2)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Absorbed shortwave radiation (W m-2)&quot;</span>, <span class="at">color =</span> <span class="st">&quot;&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-178"><a href="attachements.html#cb6-178" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="fu">hue_pal</span>()(<span class="dv">3</span>)), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb6-179"><a href="attachements.html#cb6-179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">4</span>), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb6-180"><a href="attachements.html#cb6-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">44</span>, <span class="st">&quot;pt&quot;</span>))</span>
<span id="cb6-181"><a href="attachements.html#cb6-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-182"><a href="attachements.html#cb6-182" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(out_2) <span class="sc">+</span></span>
<span id="cb6-183"><a href="attachements.html#cb6-183" aria-hidden="true" tabindex="-1"></a><span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>LAI, <span class="at">y=</span>ic_sha<span class="sc">/</span>ic))<span class="sc">+</span></span>
<span id="cb6-184"><a href="attachements.html#cb6-184" aria-hidden="true" tabindex="-1"></a><span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Fraction of radiation absorbed by shaded leaves over LAI&quot;</span>, <span class="at">y=</span><span class="st">&quot;Fraction abosorbed by shaded leaves&quot;</span>)</span>
<span id="cb6-185"><a href="attachements.html#cb6-185" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">str_wrap</span>(<span class="fu">c</span>(<span class="st">&quot;Total incoming sw&quot;</span>, <span class="st">&quot;Absorbed sw canopy&quot;</span>, <span class="st">&quot;Absorbed sw soil&quot;</span>, <span class="st">&quot;Upcoming sw&quot;</span>), <span class="dv">8</span>)</span>
<span id="cb6-186"><a href="attachements.html#cb6-186" aria-hidden="true" tabindex="-1"></a>out_2 <span class="sc">%&gt;%</span></span>
<span id="cb6-187"><a href="attachements.html#cb6-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(<span class="st">&quot;Radiation_type&quot;</span>, <span class="st">&quot;Radiation&quot;</span>, sw_in, ic, ig, i_up, <span class="at">factor_key =</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb6-188"><a href="attachements.html#cb6-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-189"><a href="attachements.html#cb6-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> LAI, <span class="at">y =</span> Radiation, <span class="at">color =</span> Radiation_type, <span class="at">linetype =</span> Radiation_type)) <span class="sc">+</span></span>
<span id="cb6-190"><a href="attachements.html#cb6-190" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;black&quot;</span>, <span class="fu">hue_pal</span>()(<span class="dv">3</span>)), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb6-191"><a href="attachements.html#cb6-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">labels =</span> labels) <span class="sc">+</span></span>
<span id="cb6-192"><a href="attachements.html#cb6-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key.height =</span> <span class="fu">unit</span>(<span class="dv">40</span>, <span class="st">&quot;pt&quot;</span>)) <span class="sc">+</span></span>
<span id="cb6-193"><a href="attachements.html#cb6-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Absorbed sw canopy, soil and upcoming sw with increasing LAI&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Incoming radiation 900 direct + 100 diffuse. Zenith 30°&quot;</span>,</span>
<span id="cb6-194"><a href="attachements.html#cb6-194" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">&quot;LAI (m2 m-2)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Shortwave radiation (W m-2)&quot;</span>)</span>
<span id="cb6-195"><a href="attachements.html#cb6-195" aria-hidden="true" tabindex="-1"></a>fake_input_3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-196"><a href="attachements.html#cb6-196" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">as.Date</span>(<span class="st">&quot;2020-07-15 12:00&quot;</span>), <span class="co"># Summer day</span></span>
<span id="cb6-197"><a href="attachements.html#cb6-197" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_in =</span> <span class="dv">800</span>,</span>
<span id="cb6-198"><a href="attachements.html#cb6-198" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_dif =</span> <span class="dv">100</span>,</span>
<span id="cb6-199"><a href="attachements.html#cb6-199" aria-hidden="true" tabindex="-1"></a>  <span class="at">lw_in =</span> <span class="dv">200</span>,</span>
<span id="cb6-200"><a href="attachements.html#cb6-200" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_soil =</span> <span class="dv">260</span><span class="sc">:</span><span class="dv">310</span>,</span>
<span id="cb6-201"><a href="attachements.html#cb6-201" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_leaf =</span> <span class="dv">260</span><span class="sc">:</span><span class="dv">310</span>,</span>
<span id="cb6-202"><a href="attachements.html#cb6-202" aria-hidden="true" tabindex="-1"></a>  <span class="at">zenith =</span> <span class="dv">30</span>,</span>
<span id="cb6-203"><a href="attachements.html#cb6-203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-204"><a href="attachements.html#cb6-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-205"><a href="attachements.html#cb6-205" aria-hidden="true" tabindex="-1"></a>out_3 <span class="ot">&lt;-</span> <span class="fu">rad_transf</span>(fake_input_3, fake_input_3) <span class="co"># the second time is for the state</span></span>
<span id="cb6-206"><a href="attachements.html#cb6-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-207"><a href="attachements.html#cb6-207" aria-hidden="true" tabindex="-1"></a>out_3 <span class="sc">%&gt;%</span></span>
<span id="cb6-208"><a href="attachements.html#cb6-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>zenith) <span class="sc">%&gt;%</span></span>
<span id="cb6-209"><a href="attachements.html#cb6-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(fake_input_3) <span class="sc">%&gt;%</span></span>
<span id="cb6-210"><a href="attachements.html#cb6-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-211"><a href="attachements.html#cb6-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> t_leaf, <span class="at">y =</span> l_up), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-212"><a href="attachements.html#cb6-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Emitted longwave with increasing temperatures&quot;</span>,</span>
<span id="cb6-213"><a href="attachements.html#cb6-213" aria-hidden="true" tabindex="-1"></a>   <span class="at">x=</span><span class="st">&quot;Leaf and Soil temperature (K)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Emitted radiation (W m-2)&quot;</span>, <span class="at">color=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb6-214"><a href="attachements.html#cb6-214" aria-hidden="true" tabindex="-1"></a>fake_input_4 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb6-215"><a href="attachements.html#cb6-215" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime =</span> <span class="fu">as.POSIXct</span>(<span class="st">&quot;2016-07-21 00:00&quot;</span>), <span class="co"># Summer day</span></span>
<span id="cb6-216"><a href="attachements.html#cb6-216" aria-hidden="true" tabindex="-1"></a>  <span class="at">zenith =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">90</span>, <span class="fl">2.5</span>),</span>
<span id="cb6-217"><a href="attachements.html#cb6-217" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_in =</span> <span class="dv">1000</span>,</span>
<span id="cb6-218"><a href="attachements.html#cb6-218" aria-hidden="true" tabindex="-1"></a>  <span class="at">sw_dif =</span> <span class="dv">100</span>,</span>
<span id="cb6-219"><a href="attachements.html#cb6-219" aria-hidden="true" tabindex="-1"></a>  <span class="at">lw_in =</span> <span class="dv">200</span>,</span>
<span id="cb6-220"><a href="attachements.html#cb6-220" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_soil =</span> <span class="dv">300</span>,</span>
<span id="cb6-221"><a href="attachements.html#cb6-221" aria-hidden="true" tabindex="-1"></a>  <span class="at">t_leaf =</span> <span class="dv">300</span>,</span>
<span id="cb6-222"><a href="attachements.html#cb6-222" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-223"><a href="attachements.html#cb6-223" aria-hidden="true" tabindex="-1"></a>out_4 <span class="ot">&lt;-</span> <span class="fu">rad_transf</span>(fake_input_4)</span>
<span id="cb6-224"><a href="attachements.html#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="attachements.html#cb6-225" aria-hidden="true" tabindex="-1"></a>out_4 <span class="sc">%&gt;%</span></span>
<span id="cb6-226"><a href="attachements.html#cb6-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>zenith) <span class="sc">%&gt;%</span></span>
<span id="cb6-227"><a href="attachements.html#cb6-227" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(fake_input_4) <span class="sc">%&gt;%</span></span>
<span id="cb6-228"><a href="attachements.html#cb6-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">absorbed_fraction =</span> ic <span class="sc">/</span> sw_in) <span class="sc">%&gt;%</span></span>
<span id="cb6-229"><a href="attachements.html#cb6-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-230"><a href="attachements.html#cb6-230" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> zenith, <span class="at">y =</span> absorbed_fraction), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb6-231"><a href="attachements.html#cb6-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Zenith (deg)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Fraction of total radiation absorbed&quot;</span>, <span class="at">title=</span><span class="st">&quot;Fraction of absorbed radiation with incresing zenith&quot;</span>)</span></code></pre></div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="discussion.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Term-paper-Radiative-Transfer-EAP.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
